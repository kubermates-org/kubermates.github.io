<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes | Kubermates</title><meta name=description content="Introduction   Hey there, Kubernetes explorer! ğŸŒŸ As your Kubernetes environment grows,..."><meta property="og:url" content="https://kubermates.org/blog/effective-vulnerability-monitoring-in-kubernetes-1mge/"><meta property="og:site_name" content="Kubermates"><meta property="og:title" content="ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes"><meta property="og:description" content="Introduction   Hey there, Kubernetes explorer! ğŸŒŸ As your Kubernetes environment grows,..."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-26T10:32:34+00:00"><meta property="article:modified_time" content="2024-08-26T10:32:34+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Cloud"><meta property="article:tag" content="Security"><meta property="article:tag" content="Azure"><meta itemprop=name content="ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes"><meta itemprop=description content="Introduction   Hey there, Kubernetes explorer! ğŸŒŸ As your Kubernetes environment grows,..."><meta itemprop=datePublished content="2024-08-26T10:32:34+00:00"><meta itemprop=dateModified content="2024-08-26T10:32:34+00:00"><meta itemprop=wordCount content="1429"><meta itemprop=keywords content="Kubernetes,Cloud,Security,Azure"><meta name=twitter:card content="summary"><meta name=twitter:title content="ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes"><meta name=twitter:description content="Introduction   Hey there, Kubernetes explorer! ğŸŒŸ As your Kubernetes environment grows,..."><link rel=preload href=/scss/main.min.197a4af99ef9ed3dfd33450e7627d46f0285eb67fc3e6acc5ca34da69932fa68.css as=style integrity="sha256-GXpK+Z757T39M0UOdifUbwKF62f8PmrMXKNNppky+mg=" crossorigin=anonymous><link href=/scss/main.min.197a4af99ef9ed3dfd33450e7627d46f0285eb67fc3e6acc5ca34da69932fa68.css rel=stylesheet integrity="sha256-GXpK+Z757T39M0UOdifUbwKF62f8PmrMXKNNppky+mg=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=theme-color content="#00D1B2"></head><body class="td-page td-blog"><header><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container-fluid><a class=navbar-brand href=https://kubermates.org/><img src=/images/nav-logo-white.png srcset="/images/nav-logo-white.png 1x, /images/nav-logo-white@2x.png 2x" alt=Kubermates width=auto height=48>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ms-auto mb-2 mb-lg-0"><li class=nav-item><a class=nav-link href=/blog/>Articles</a></li><li class=nav-item><a class=nav-link href=/events/>Events</a></li><li class=nav-item><a class=nav-link href=/docs/>Docs</a></li><li class=nav-item><a class=nav-link href=/releases/>Releases</a></li><li class=nav-item><a class=nav-link href=/contribute/>Contribute</a></li></ul></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogfirst-post-li><a href=/blog/first-post/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogfirst-post><span>launching kubermates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih-li><a href=/blog/github-actions-composite-vs-reusable-workflows-4bih/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih><span>ğŸ§© GitHub Actions Composite vs Reusable Workflows</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc-li><a href=/blog/elevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc><span>ğŸš€ğŸŒ Elevating Infrastructure: From Terraform/Terragrunt Foundations to Platform Engineering ğŸ˜Š</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-helm-1940-li><a href=/blog/secure-secret-management-with-sops-in-helm-1940/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-helm-1940><span>ğŸ” Secure Secret Management with SOPS in Helm ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a-li><a href=/blog/secure-secret-management-with-sops-in-terraform-terragrunt-231a/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a><span>ğŸ” Secure Secret Management with SOPS in Terraform & Terragrunt</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca-li><a href=/blog/helm-chart-essentials-writing-effective-charts-11ca/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca><span>Helm Chart Essentials & Writing Effective Charts ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89-li><a href=/blog/unlocking-secrets-with-external-secrets-operator-2f89/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89><span>Unlocking Secrets with External Secrets Operator ğŸ”âœ¨</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk-li><a href=/blog/automating-dns-in-azure-private-dns-with-external-dns-3knk/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk><span>Automating DNS in Azure Private DNS with External-DNS â˜ï¸ğŸ”</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh-li><a href=/blog/using-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh><span>Using Nginx Ingress Controller and Cert-Manager for HTTPS with Letâ€™s Encrypt âš¡</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0-li><a href=/blog/ensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0><span>Ensuring Effective Helm Charts with Linting, Testing, and Diff Checks ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5-li><a href=/blog/capsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5><span>Capsule: How to Use It and First Steps to Set It Up on an AKS Cluster ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh-li><a href=/blog/understanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh><span>Understanding AKS NAP: Azure Kubernetes Service Node Auto-Provisioning (Powered by Karpenter) ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d-li><a href=/blog/admission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d><span>Admission Controllers in Kubernetes: OPA GateKeeper, Kyverno, and Azure Policy Add-on for AKSâ€”Which One Wins? ğŸ†</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap-li><a href=/blog/upgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap><span>Upgrading AKS: In-Place, Blue-Green, and Canary Upgrades Explained ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627-li><a href=/blog/monitor-and-optimize-multi-cluster-aks-costs-4627/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627><span>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida-li><a href=/blog/enhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida><span>ğŸš€ Enhancing Container Security: The Complete Guide to Secure and Clean Kubernetes Clusters ğŸ›¡ï¸ğŸ§¼</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08-li><a href=/blog/karmada-deep-dive-into-managing-multiple-aks-clusters-1j08/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08><span>Karmada: Deep Dive into Managing Multiple AKS Clusters ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99-li><a href=/blog/understanding-ebpf-and-its-application-in-modern-cloud-environments-3f99/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99><span>Understanding eBPF and Its Application in Modern Cloud Environments ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k-li><a href=/blog/securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k><span>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l-li><a href=/blog/automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l><span>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo-li><a href=/blog/autoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo><span>Autoscaling in Kubernetes: KEDA, Karpenter, and Native Autoscalers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g-li><a href=/blog/insights-on-securing-your-kubernetes-cluster-with-falco-4b9g/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g><span>Insights on Securing Your Kubernetes Cluster with Falco ğŸš€ğŸ”’</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil-li><a href=/blog/building-a-kubernetes-operator-with-an-nginx-crd-3lil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil><span>ğŸš€ Building a Kubernetes Operator with an NGINX CRD</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l-li><a href=/blog/hacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l><span>ğŸ¨ Hacking the Helm Operator with Flux: Creating Self-Installable Services for Easier App Deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogchaos-engineering-lets-break-everything-io0-li><a href=/blog/chaos-engineering-lets-break-everything-io0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogchaos-engineering-lets-break-everything-io0><span>Chaos Engineering Let's Break Everything! ğŸ˜ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017-li><a href=/blog/a-guide-to-modern-kubernetes-service-networking-4017/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017><span>A Guide to Modern Kubernetes Service Networking ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge-li><a href=/blog/effective-vulnerability-monitoring-in-kubernetes-1mge/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge><span class=td-sidebar-nav-active-item>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-multi-cluster-management-1nek-li><a href=/blog/kubernetes-multi-cluster-management-1nek/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-multi-cluster-management-1nek><span>Kubernetes Multi-Cluster Management ğŸ“¦</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l-li><a href=/blog/how-to-make-your-docker-images-go-on-a-diet-88l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l><span>How to Make Your Docker Images Go on a Diet ğŸŠâ€â™‚ï¸</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea-li><a href=/blog/a-quick-navigation-through-service-mesh-in-kubernetes-5dea/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea><span>A quick navigation through Service Mesh in Kubernetes ğŸ‘€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o-li><a href=/blog/kubernetes-rbac-and-role-aggregation-made-easy-3j4o/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o><span>ğŸš€ Kubernetes RBAC and Role Aggregation Made Easy</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54-li><a href=/blog/essential-tips-for-setting-resource-limits-in-kubernetes-3b54/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54><span>Essential Tips for Setting Resource Limits in Kubernetes ğŸ“ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3-li><a href=/blog/kubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3><span>ğŸŒ Kubernetes DNS: How to Use In-Cluster and Azure Private DNS Together</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33-li><a href=/blog/how-to-manage-kubernetes-app-storage-like-a-pro-o33/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33><span>How to Manage Kubernetes App Storage Like a Pro ğŸ“</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2-li><a href=/blog/understanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2><span>Understanding Pod Topology Spread Constraints and Node Affinity in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec-li><a href=/blog/how-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec><span>How to Test the Latest Kubernetes Changes in Version 1.31 "Elli"</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubermates-org/kubermates-site/tree/main/content/blog/2024-08-26-effective-vulnerability-monitoring-in-kubernetes-1mge.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/kubermates-org/kubermates-site/edit/main/content/blog/2024-08-26-effective-vulnerability-monitoring-in-kubernetes-1mge.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubermates-org/kubermates-site/new/main/content/blog?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/kubermates-org/kubermates-site/issues/new?title=%f0%9f%9b%a1%ef%b8%8f%20Effective%20Vulnerability%20Monitoring%20in%20Kubernetes" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#prerequisites->Prerequisites ğŸ› ï¸</a></li><li><a href=#step-1-deploy-trivy-operator-in-each-spoke-kubernetes-cluster->Step 1: Deploy Trivy Operator in Each Spoke Kubernetes Cluster ğŸš¢</a><ul><li><a href=#1-install-trivy-operator-in-spoke-clusters>1. Install Trivy Operator in Spoke Clusters</a></li><li><a href=#2-customize-scanning>2. Customize Scanning</a></li><li><a href=#3-verify-the-setup>3. Verify the Setup</a></li><li><a href=#5-verify-trivy-operator-metrics>5. Verify Trivy Operator Metrics</a></li></ul></li><li><a href=#step-2-deploy-opentelemetry-collectors-in-each-spoke-cluster->Step 2: Deploy OpenTelemetry Collectors in Each Spoke Cluster ğŸŒ</a><ul><li><a href=#1-install-opentelemetry-collector-in-each-spoke-cluster>1. Install OpenTelemetry Collector in Each Spoke Cluster</a></li><li><a href=#2-configure-opentelemetry-collector>2. Configure OpenTelemetry Collector</a></li><li><a href=#3-apply-the-configuration>3. Apply the Configuration</a></li></ul></li><li><a href=#step-3-set-up-the-centralized-prometheus-and-grafana->Step 3: Set Up the Centralized Prometheus and Grafana ğŸ“Š</a><ul><li><a href=#option-1-self-hosted-prometheus-and-grafana>Option 1: Self-Hosted Prometheus and Grafana</a></li><li><a href=#option-2-azure-monitor-for-prometheus-and-managed-grafana>Option 2: Azure Monitor for Prometheus and Managed Grafana</a></li><li><a href=#3-create-dashboards-in-grafana>3. Create Dashboards in Grafana</a></li><li><a href=#4-build-a-unified-dashboard>4. Build a Unified Dashboard</a></li></ul></li><li><a href=#wrapping-up->Wrapping Up ğŸ</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/announcement/ data-taxonomy-term=announcement><span class=taxonomy-label>Announcement</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/automation/ data-taxonomy-term=automation><span class=taxonomy-label>Automation</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>21</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span><span class=taxonomy-count>13</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cicd/ data-taxonomy-term=cicd><span class=taxonomy-label>Cicd</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span><span class=taxonomy-count>28</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud-foundation/ data-taxonomy-term=cloud-foundation><span class=taxonomy-label>Cloud-Foundation</span><span class=taxonomy-count>51</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloudnative/ data-taxonomy-term=cloudnative><span class=taxonomy-label>Cloudnative</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cncf/ data-taxonomy-term=cncf><span class=taxonomy-label>Cncf</span><span class=taxonomy-count>268</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/community/ data-taxonomy-term=community><span class=taxonomy-label>Community</span><span class=taxonomy-count>53</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/containers/ data-taxonomy-term=containers><span class=taxonomy-label>Containers</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/devops/ data-taxonomy-term=devops><span class=taxonomy-label>Devops</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>Docker</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/eks/ data-taxonomy-term=eks><span class=taxonomy-label>Eks</span><span class=taxonomy-count>52</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/event/ data-taxonomy-term=event><span class=taxonomy-label>Event</span><span class=taxonomy-count>221</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/falco/ data-taxonomy-term=falco><span class=taxonomy-label>Falco</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/finops/ data-taxonomy-term=finops><span class=taxonomy-label>Finops</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>Github</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/githubactions/ data-taxonomy-term=githubactions><span class=taxonomy-label>Githubactions</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/gitops/ data-taxonomy-term=gitops><span class=taxonomy-label>Gitops</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/gke/ data-taxonomy-term=gke><span class=taxonomy-label>Gke</span><span class=taxonomy-count>74</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/grafana/ data-taxonomy-term=grafana><span class=taxonomy-label>Grafana</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/jenkins-x/ data-taxonomy-term=jenkins-x><span class=taxonomy-label>Jenkins-X</span><span class=taxonomy-count>50</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/k3s/ data-taxonomy-term=k3s><span class=taxonomy-label>K3s</span><span class=taxonomy-count>25</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/karmada/ data-taxonomy-term=karmada><span class=taxonomy-label>Karmada</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kodekloud/ data-taxonomy-term=kodekloud><span class=taxonomy-label>Kodekloud</span><span class=taxonomy-count>20</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kubeflow/ data-taxonomy-term=kubeflow><span class=taxonomy-label>Kubeflow</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span><span class=taxonomy-count>461</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/networking/ data-taxonomy-term=networking><span class=taxonomy-label>Networking</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/nirmata/ data-taxonomy-term=nirmata><span class=taxonomy-label>Nirmata</span><span class=taxonomy-count>16</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/openshift/ data-taxonomy-term=openshift><span class=taxonomy-label>Openshift</span><span class=taxonomy-count>30</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/opensource/ data-taxonomy-term=opensource><span class=taxonomy-label>Opensource</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/productivity/ data-taxonomy-term=productivity><span class=taxonomy-label>Productivity</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/programming/ data-taxonomy-term=programming><span class=taxonomy-label>Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rancher/ data-taxonomy-term=rancher><span class=taxonomy-label>Rancher</span><span class=taxonomy-count>56</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rke/ data-taxonomy-term=rke><span class=taxonomy-label>Rke</span><span class=taxonomy-count>13</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rke2/ data-taxonomy-term=rke2><span class=taxonomy-label>Rke2</span><span class=taxonomy-count>26</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rss/ data-taxonomy-term=rss><span class=taxonomy-label>Rss</span><span class=taxonomy-count>10</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>17</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/servicemesh/ data-taxonomy-term=servicemesh><span class=taxonomy-label>Servicemesh</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terraform/ data-taxonomy-term=terraform><span class=taxonomy-label>Terraform</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terragrunt/ data-taxonomy-term=terragrunt><span class=taxonomy-label>Terragrunt</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/tigera/ data-taxonomy-term=tigera><span class=taxonomy-label>Tigera</span><span class=taxonomy-count>25</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/trivy/ data-taxonomy-term=trivy><span class=taxonomy-label>Trivy</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/vmware/ data-taxonomy-term=vmware><span class=taxonomy-label>Vmware</span><span class=taxonomy-count>51</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/blog/>Blogs</a></li><li class="breadcrumb-item active" aria-current=page>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes</li></ol></nav><div class=td-content><h1>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes</h1><div class=lead>Introduction Hey there, Kubernetes explorer! ğŸŒŸ As your Kubernetes environment grows,&mldr;</div><div class="td-byline mb-4"><time datetime=2024-08-26 class=text-body-secondary>Monday, August 26, 2024</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span></a></li></ul></div></header><h2 id=introduction>Introduction</h2><p>Hey there, Kubernetes explorer! ğŸŒŸ As your Kubernetes environment grows, keeping it secure becomes more challenging, especially when dealing with multiple clusters. Imagine managing several clusters (spokes) and needing a single source of truth for all your security metricsâ€”sounds like a big task, right? ğŸ¤” That&rsquo;s where <strong>Trivy</strong>, <strong>Trivy Operator</strong>, <strong>OpenTelemetry</strong>, <strong>Prometheus</strong>, and <strong>Grafana</strong> come to the rescue.</p><p>In this guide, Iâ€™ll show you how to set up Trivy and Trivy Operator in a federated Kubernetes environment, collect vulnerability data using OpenTelemetry, and centralize it using either an in-cluster Prometheus setup or managed services like <strong>Azure Monitor (for Prometheus)</strong> and <strong>Grafana Cloud</strong> or <strong>Azure Managed Grafana</strong>. By the end of this, youâ€™ll have a system that monitors vulnerabilities across all your clusters from one place. Letâ€™s dive in! ğŸŠâ€â™‚ï¸</p><h2 id=prerequisites->Prerequisites ğŸ› ï¸</h2><p>Before we get started, make sure you have:</p><ul><li>Multiple Kubernetes clusters (managed via Kubernetes Federation or another method), including a central (hub) cluster and multiple spoke clusters.</li><li>Admin access to each cluster.</li><li>OpenTelemetry Collector set up in each spoke cluster.</li><li>Basic knowledge of Kubernetes, OpenTelemetry, Prometheus, and Grafana.</li></ul><h2 id=step-1-deploy-trivy-operator-in-each-spoke-kubernetes-cluster->Step 1: Deploy Trivy Operator in Each Spoke Kubernetes Cluster ğŸš¢</h2><p>The first step is to deploy Trivy Operator in each of your spoke clusters. The Trivy Operator integrates directly with Kubernetes, automatically scanning workloads for vulnerabilities and exposes these results as Prometheus-compatible metrics.</p><h3 id=1-install-trivy-operator-in-spoke-clusters>1. Install Trivy Operator in Spoke Clusters</h3><p>Letâ€™s start by installing Trivy Operator in each of your spoke clusters using Helm. Open up your terminal and run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add aqua https://aquasecurity.github.io/helm-charts/
</span></span><span class=line><span class=cl>helm repo update
</span></span><span class=line><span class=cl>helm install trivy-operator aqua/trivy-operator --namespace trivy-system --create-namespace
</span></span></code></pre></div><p>This installs the Trivy Operator in the <code>trivy-system</code> namespace. Now, each of your spoke clusters is ready to start scanning for vulnerabilities!</p><p>For more details, check out the <a href=https://aquasecurity.github.io/trivy-operator/latest/>Trivy Operator documentation</a> and <a href=https://github.com/aquasecurity/helm-charts>Helm chart repository</a>.</p><p>For additional configuration options, refer to the <a href=https://aquasecurity.github.io/trivy-operator/v0.22.0/tutorials/integrations/metrics/>Trivy Operator Metrics documentation</a>.</p><h3 id=2-customize-scanning>2. Customize Scanning</h3><p>You can configure Trivy Operator to scan based on your specific needs. For instance, you might want to scan for only high and critical vulnerabilities or ignore certain files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>trivy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>HIGH,CRITICAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ignoreUnfixed</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>skipFiles</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/usr/local/bin&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>To apply these settings, update the <code>values.yaml</code> file before installation or use the <code>--set</code> flag in Helm:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade trivy-operator aqua/trivy-operator --namespace trivy-system --set trivy.severity<span class=o>=</span>HIGH,CRITICAL --set trivy.ignoreUnfixed<span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></div><h3 id=3-verify-the-setup>3. Verify the Setup</h3><p>After deployment, verify that the Trivy Operator is up and running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods -n trivy-system
</span></span></code></pre></div><p>You should see the Trivy Operator pods running. To check if itâ€™s scanning correctly, look at the generated <code>VulnerabilityReport</code> resources:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get vulnerabilityreports -A
</span></span></code></pre></div><p>This command will show you the vulnerability reports across all namespaces, confirming that Trivy Operator is working as expected.</p><h3 id=5-verify-trivy-operator-metrics>5. Verify Trivy Operator Metrics</h3><p>Ensure that the Trivy Operator is exposing the metrics correctly. You can check this by port-forwarding the Trivy Operator service and curling the metrics endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl port-forward service/trivy-operator -n trivy-system 5000:80
</span></span></code></pre></div><p>This should return a list of Prometheus-compatible metrics related to Trivy vulnerabilities, confirming that Trivy Operator metrics are functioning properly.</p><h2 id=step-2-deploy-opentelemetry-collectors-in-each-spoke-cluster->Step 2: Deploy OpenTelemetry Collectors in Each Spoke Cluster ğŸŒ</h2><p>With Trivy Operator running in each spoke cluster, the next step is to deploy OpenTelemetry Collectors to gather and forward the metrics to your central Prometheus instance or Azure Monitor for Prometheus.</p><h3 id=1-install-opentelemetry-collector-in-each-spoke-cluster>1. Install OpenTelemetry Collector in Each Spoke Cluster</h3><p>Deploy the OpenTelemetry Collector in each spoke cluster. The collector will scrape metrics from the Trivy Operator and send them to your centralized Prometheus solution, whether that&rsquo;s a self-hosted instance, Azure Monitor, or another service.</p><p>You can deploy the OpenTelemetry Collector using Helm or by applying Kubernetes manifests. Hereâ€™s an example using Helm:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
</span></span><span class=line><span class=cl>helm repo update
</span></span><span class=line><span class=cl>helm install otel-collector open-telemetry/opentelemetry-collector --namespace monitoring --create-namespace
</span></span></code></pre></div><p>For more detailed configuration options, refer to the <a href=https://github.com/open-telemetry/opentelemetry-helm-charts>OpenTelemetry Collector Helm chart documentation</a>.</p><h3 id=2-configure-opentelemetry-collector>2. Configure OpenTelemetry Collector</h3><p>Youâ€™ll need to configure the OpenTelemetry Collector to scrape metrics from the Trivy Operator and forward them to your central Prometheus instance. Depending on your setup, you might be using:</p><ul><li><strong>Self-Hosted Prometheus (External Access)</strong>: Prometheus hosted in your central hub cluster.</li><li><strong>Azure Monitor for Prometheus</strong>: Managed Prometheus service offered by Azure.</li></ul><h4 id=example-configuration-for-self-hosted-prometheus>Example Configuration for Self-Hosted Prometheus:</h4><p>Hereâ€™s an example configuration for the OpenTelemetry Collector if youâ€™re using a self-hosted Prometheus instance:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;trivy-operator&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;trivy-operator.trivy-system.svc.cluster.local:9100&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheusremotewrite</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://&lt;EXTERNAL_PROMETHEUS_HUB_URL&gt;:9090/api/v1/write&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>prometheusremotewrite]</span><span class=w>
</span></span></span></code></pre></div><h4 id=example-configuration-for-azure-monitor-for-prometheus>Example Configuration for Azure Monitor for Prometheus:</h4><p>If youâ€™re using Azure Monitor for Prometheus, your configuration would look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;trivy-operator&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>15s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;trivy-operator.trivy-system.svc.cluster.local:9100&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheusremotewrite</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://&lt;YOUR_AZURE_PROMETHEUS_URL&gt;/api/v1/write&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>Authorization</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Bearer &lt;YOUR_AZURE_API_TOKEN&gt;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>prometheusremotewrite]</span><span class=w>
</span></span></span></code></pre></div><p>Replace <code>&lt;EXTERNAL_PROMETHEUS_HUB_URL></code> or <code>&lt;YOUR_AZURE_PROMETHEUS_URL></code> and <code>&lt;YOUR_AZURE_API_TOKEN></code> with your actual Prometheus endpoint and API token. This configuration tells the OpenTelemetry Collector to scrape metrics from the Trivy Operator and then send them to the specified Prometheus instance.</p><h3 id=3-apply-the-configuration>3. Apply the Configuration</h3><p>Once youâ€™ve configured the OpenTelemetry Collector, apply the configuration to your cluster:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f otel-collector-config.yaml -n monitoring
</span></span></code></pre></div><p>Ensure that the OpenTelemetry Collector is running correctly and scraping metrics by checking the logs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>otel-collector -n monitoring
</span></span></code></pre></div><h2 id=step-3-set-up-the-centralized-prometheus-and-grafana->Step 3: Set Up the Centralized Prometheus and Grafana ğŸ“Š</h2><p>Now that youâ€™ve set up OpenTelemetry Collectors in each spoke cluster, the next step is to configure your centralized monitoring solution. You have two primary options: using a self-hosted Prometheus and Grafana setup or leveraging managed services like Azure Monitor for Prometheus and Grafana Cloud or Azure Managed Grafana.</p><h3 id=option-1-self-hosted-prometheus-and-grafana>Option 1: Self-Hosted Prometheus and Grafana</h3><h4 id=1-set-up-prometheus-in-the-hub-cluster>1. Set Up Prometheus in the Hub Cluster</h4><p>If you prefer to manage Prometheus yourself, deploy it in the hub cluster with external access:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install prometheus-hub prometheus-community/prometheus --namespace monitoring --create-namespace
</span></span></code></pre></div><p>Expose Prometheus externally using an Ingress, LoadBalancer, or NodePort service, depending on your environment. For more information on setting up Prometheus with external access, refer to the <a href=https://prometheus.io/docs/introduction/overview/>Prometheus documentation</a>.</p><h4 id=2-set-up-grafana-in-the-hub-cluster>2. Set Up Grafana in the Hub Cluster</h4><p>Deploy Grafana in your hub cluster:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install grafana
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> grafana/grafana --namespace monitoring --create-namespace
</span></span></code></pre></div><p>Access Grafana by forwarding the port or exposing the service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl port-forward svc/grafana 3000:80 -n monitoring
</span></span></code></pre></div><p>Add your self-hosted Prometheus as a data source in Grafana, using the external URL of Prometheus (e.g., <code>http://&lt;EXTERNAL_PROMETHEUS_HUB_URL>:9090</code>).</p><h3 id=option-2-azure-monitor-for-prometheus-and-managed-grafana>Option 2: Azure Monitor for Prometheus and Managed Grafana</h3><p>If you prefer a managed solution, Azure offers managed services for both Prometheus and Grafana, which can simplify operations and scalability.</p><h4 id=1-set-up-azure-monitor-for-prometheus>1. Set Up Azure Monitor for Prometheus</h4><p>To set up Azure Monitor for Prometheus, follow the instructions in the <a href=https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/prometheus-metrics-overview>Azure documentation</a>. Youâ€™ll configure OpenTelemetry Collectors in your spoke clusters to send metrics to Azure Monitor using the <code>prometheusremotewrite</code> exporter.</p><h4 id=2-set-up-grafana-cloud-or-azure-managed-grafana>2. Set Up Grafana Cloud or Azure Managed Grafana</h4><p>Azure also offers a managed Grafana service that integrates seamlessly with Azure Monitor for Prometheus. You can set up Azure Managed Grafana by following the <a href=https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/prometheus-grafana#azure-managed-grafana>official documentation</a>.</p><p>After setting up, add Azure Monitor as a data source in Grafana, and start creating your dashboards using the metrics collected from your clusters.</p><h3 id=3-create-dashboards-in-grafana>3. Create Dashboards in Grafana</h3><p>Regardless of whether youâ€™re using a self-hosted or managed solution, youâ€™ll want to visualize the data in Grafana. Here are a few panel ideas:</p><ul><li><p><strong>Vulnerabilities by Severity</strong>: Show the count of vulnerabilities categorized by severity (e.g., Critical, High, Medium).</p><p><strong>PromQL Query:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-promql data-lang=promql><span class=line><span class=cl><span class=k>count</span><span class=o>(</span><span class=nv>trivy_image_vulnerabilities</span><span class=p>{</span><span class=nl>severity</span><span class=o>=</span><span class=p>&#34;</span><span class=s>CRITICAL</span><span class=p>&#34;}</span><span class=o>)</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>Vulnerabilities Over Time</strong>: Display how the number of vulnerabilities changes over time.</p><p><strong>PromQL Query:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-promql data-lang=promql><span class=line><span class=cl><span class=kr>count_over_time</span><span class=o>(</span><span class=nv>trivy_image_vulnerabilities</span><span class=p>[</span><span class=s>1h</span><span class=p>]</span><span class=o>)</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>Vulnerabilities by Cluster</strong>: Compare the vulnerabilities across different spoke clusters.</p><p><strong>PromQL Query:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-promql data-lang=promql><span class=line><span class=cl><span class=k>count</span><span class=o>(</span><span class=nv>trivy_image_vulnerabilities</span><span class=p>{</span><span class=nl>severity</span><span class=o>=</span><span class=p>&#34;</span><span class=s>HIGH</span><span class=p>&#34;}</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=o>(</span><span class=nv>cluster</span><span class=o>))</span><span class=w>
</span></span></span></code></pre></div></li><li><p><strong>Top Vulnerable Images</strong>: List the most vulnerable container images across all clusters.</p><p><strong>PromQL Query:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-promql data-lang=promql><span class=line><span class=cl><span class=k>topk</span><span class=o>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=k>sum</span><span class=o>(</span><span class=nv>trivy_image_vulnerabilities</span><span class=o>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=o>(</span><span class=nv>image</span><span class=o>))</span><span class=w>
</span></span></span></code></pre></div></li></ul><h3 id=4-build-a-unified-dashboard>4. Build a Unified Dashboard</h3><p>Organize these panels into a comprehensive dashboard:</p><ul><li><strong>Top Row</strong>: Summary stats (e.g., total vulnerabilities, total critical).</li><li><strong>Middle Row</strong>: Time series charts showing vulnerabilities over time.</li><li><strong>Bottom Row</strong>: Breakdown by cluster and by container image.</li></ul><h2 id=wrapping-up->Wrapping Up ğŸ</h2><p>And there you have it! Youâ€™ve successfully set up a federated vulnerability scanning solution across multiple Kubernetes clusters using Trivy, Trivy Operator, OpenTelemetry, and either a self-hosted or managed Prometheus and Grafana setup. By leveraging OpenTelemetry and centralized monitoring solutions like Azure Monitor for Prometheus and Managed Grafana, you can monitor your security posture from a single location, simplifying operations and ensuring scalability. ğŸš€</p><p>This setup not only makes vulnerability management easier but also ensures that no matter how many clusters you manage, you always have a clear view of their security status.</p><p>Happy scanning, and stay secure! ğŸ”</p><p>For further reading and deeper understanding, you might want to check out the official documentation for each of the tools:</p><ul><li><a href=https://aquasecurity.github.io/trivy/>Trivy</a></li><li><a href=https://aquasecurity.github.io/trivy-operator/latest/docs/>Trivy Operator</a></li><li><a href=https://opentelemetry.io/docs/>OpenTelemetry</a></li><li><a href=https://prometheus.io/docs/introduction/overview/>Prometheus</a></li><li><a href=https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/prometheus-metrics-overview>Azure Monitor for Prometheus</a></li><li><a href=https://grafana.com/docs/>Grafana</a></li></ul><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/kubernetes-multi-cluster-management-1nek/ aria-label="Previous - Kubernetes Multi-Cluster Management ğŸ“¦" class="btn btn-primary"><span class=me-1>â†</span>Previous</a></li><li><a href=/blog/a-guide-to-modern-kubernetes-service-networking-4017/ aria-label="Next - A Guide to Modern Kubernetes Service Networking ğŸš€" class="btn btn-primary">Next<span class=ms-1>â†’</span></a></li></ul></div></main></div></div><footer class=km-footer role=contentinfo><style>.km-footer{background:#0a2540;color:#fff;padding:15px 0;margin:0;width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);border:0;outline:0;padding-left:0;padding-right:0}.km-footer a{color:#00d1b2;text-decoration:none}.km-footer .km-social{display:flex;justify-content:center;gap:20px;margin-top:8px}.km-footer .km-social a{color:#00d1b2!important;font-size:28px;line-height:1;transition:color .2s ease}.km-footer .km-social a:hover{color:#10b981!important}html,body{overflow-x:hidden}</style><div class=text-center><p class=mb-1 style=margin:0>Â© 2025 Kubermates powered by
<a href=https://kapheira.cloud>Kapheira</a> and
<a href=https://www.linkedin.com/in/hamdi-khelil/ rel=author>Hamdi KHELIL</a>.</p><div class=km-social><a href=https://github.com/kubermates-org target=_blank rel=noopener aria-label=GitHub><i class="fab fa-github" aria-hidden=true></i>
</a><a href=https://www.linkedin.com/company/kubermates target=_blank rel=noopener aria-label=LinkedIn><i class="fab fa-linkedin" aria-hidden=true></i>
</a><a href=https://www.youtube.com/@Kubermates target=_blank rel=noopener aria-label=YouTube><i class="fab fa-youtube" aria-hidden=true></i>
</a><a href=https://kubermates.slack.com target=_blank rel=noopener aria-label=Slack><i class="fab fa-slack" aria-hidden=true></i></a></div></div></footer></div><script src=/js/main.min.d844e8cb3c2d74f005336b0c873045728e53ff0ce5534c7d8563fa0676a87b08.js integrity="sha256-2EToyzwtdPAFM2sMhzBFco5T/wzlU0x9hWP6Bnaoewg=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>