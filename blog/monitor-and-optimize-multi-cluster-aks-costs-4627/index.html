<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’° | Kubermates</title><meta name=description content="As businesses scale their Kubernetes workloads across multiple Azure Kubernetes Service (AKS)..."><meta property="og:url" content="https://kubermates.org/blog/monitor-and-optimize-multi-cluster-aks-costs-4627/"><meta property="og:site_name" content="Kubermates"><meta property="og:title" content="Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°"><meta property="og:description" content="As businesses scale their Kubernetes workloads across multiple Azure Kubernetes Service (AKS)..."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-09-12T07:42:06+00:00"><meta property="article:modified_time" content="2024-09-12T07:42:06+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Cloud"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Finops"><meta itemprop=name content="Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°"><meta itemprop=description content="As businesses scale their Kubernetes workloads across multiple Azure Kubernetes Service (AKS)..."><meta itemprop=datePublished content="2024-09-12T07:42:06+00:00"><meta itemprop=dateModified content="2024-09-12T07:42:06+00:00"><meta itemprop=wordCount content="1180"><meta itemprop=keywords content="Kubernetes,Cloud,Azure,Finops"><meta name=twitter:card content="summary"><meta name=twitter:title content="Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°"><meta name=twitter:description content="As businesses scale their Kubernetes workloads across multiple Azure Kubernetes Service (AKS)..."><link rel=preload href=/scss/main.min.e8cc45d85315a21706a63b6ac89bd1b180ed25b3b643edc182d2d0d09e89769e.css as=style integrity="sha256-6MxF2FMVohcGpjtqyJvRsYDtJbO2Q+3BgtLQ0J6Jdp4=" crossorigin=anonymous><link href=/scss/main.min.e8cc45d85315a21706a63b6ac89bd1b180ed25b3b643edc182d2d0d09e89769e.css rel=stylesheet integrity="sha256-6MxF2FMVohcGpjtqyJvRsYDtJbO2Q+3BgtLQ0J6Jdp4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><link rel=icon href=/images/favicon.ico></head><body class="td-page td-blog"><header><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container-fluid><a class=navbar-brand href=https://kubermates.org/><img src=/images/logo.png alt="Kubermates Logo" height=40 class="d-inline-block align-text-top">
Kubermates
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a class=nav-link href=/blog/>Articles</a></li><li class=nav-item><a class=nav-link href=/events/>Events</a></li><li class=nav-item><a class=nav-link href=/contribute/>Contribute</a></li></ul></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogfirst-post-li><a href=/blog/first-post/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogfirst-post><span>launching kubermates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih-li><a href=/blog/github-actions-composite-vs-reusable-workflows-4bih/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih><span>ğŸ§© GitHub Actions Composite vs Reusable Workflows</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc-li><a href=/blog/elevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc><span>ğŸš€ğŸŒ Elevating Infrastructure: From Terraform/Terragrunt Foundations to Platform Engineering ğŸ˜Š</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-helm-1940-li><a href=/blog/secure-secret-management-with-sops-in-helm-1940/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-helm-1940><span>ğŸ” Secure Secret Management with SOPS in Helm ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a-li><a href=/blog/secure-secret-management-with-sops-in-terraform-terragrunt-231a/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a><span>ğŸ” Secure Secret Management with SOPS in Terraform & Terragrunt</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca-li><a href=/blog/helm-chart-essentials-writing-effective-charts-11ca/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca><span>Helm Chart Essentials & Writing Effective Charts ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89-li><a href=/blog/unlocking-secrets-with-external-secrets-operator-2f89/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89><span>Unlocking Secrets with External Secrets Operator ğŸ”âœ¨</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk-li><a href=/blog/automating-dns-in-azure-private-dns-with-external-dns-3knk/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk><span>Automating DNS in Azure Private DNS with External-DNS â˜ï¸ğŸ”</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh-li><a href=/blog/using-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh><span>Using Nginx Ingress Controller and Cert-Manager for HTTPS with Letâ€™s Encrypt âš¡</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0-li><a href=/blog/ensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0><span>Ensuring Effective Helm Charts with Linting, Testing, and Diff Checks ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5-li><a href=/blog/capsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5><span>Capsule: How to Use It and First Steps to Set It Up on an AKS Cluster ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh-li><a href=/blog/understanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh><span>Understanding AKS NAP: Azure Kubernetes Service Node Auto-Provisioning (Powered by Karpenter) ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d-li><a href=/blog/admission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d><span>Admission Controllers in Kubernetes: OPA GateKeeper, Kyverno, and Azure Policy Add-on for AKSâ€”Which One Wins? ğŸ†</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap-li><a href=/blog/upgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap><span>Upgrading AKS: In-Place, Blue-Green, and Canary Upgrades Explained ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627-li><a href=/blog/monitor-and-optimize-multi-cluster-aks-costs-4627/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627><span class=td-sidebar-nav-active-item>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida-li><a href=/blog/enhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida><span>ğŸš€ Enhancing Container Security: The Complete Guide to Secure and Clean Kubernetes Clusters ğŸ›¡ï¸ğŸ§¼</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08-li><a href=/blog/karmada-deep-dive-into-managing-multiple-aks-clusters-1j08/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08><span>Karmada: Deep Dive into Managing Multiple AKS Clusters ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99-li><a href=/blog/understanding-ebpf-and-its-application-in-modern-cloud-environments-3f99/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99><span>Understanding eBPF and Its Application in Modern Cloud Environments ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k-li><a href=/blog/securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k><span>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l-li><a href=/blog/automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l><span>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo-li><a href=/blog/autoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo><span>Autoscaling in Kubernetes: KEDA, Karpenter, and Native Autoscalers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g-li><a href=/blog/insights-on-securing-your-kubernetes-cluster-with-falco-4b9g/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g><span>Insights on Securing Your Kubernetes Cluster with Falco ğŸš€ğŸ”’</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil-li><a href=/blog/building-a-kubernetes-operator-with-an-nginx-crd-3lil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil><span>ğŸš€ Building a Kubernetes Operator with an NGINX CRD</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l-li><a href=/blog/hacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l><span>ğŸ¨ Hacking the Helm Operator with Flux: Creating Self-Installable Services for Easier App Deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogchaos-engineering-lets-break-everything-io0-li><a href=/blog/chaos-engineering-lets-break-everything-io0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogchaos-engineering-lets-break-everything-io0><span>Chaos Engineering Let's Break Everything! ğŸ˜ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017-li><a href=/blog/a-guide-to-modern-kubernetes-service-networking-4017/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017><span>A Guide to Modern Kubernetes Service Networking ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge-li><a href=/blog/effective-vulnerability-monitoring-in-kubernetes-1mge/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge><span>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-multi-cluster-management-1nek-li><a href=/blog/kubernetes-multi-cluster-management-1nek/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-multi-cluster-management-1nek><span>Kubernetes Multi-Cluster Management ğŸ“¦</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l-li><a href=/blog/how-to-make-your-docker-images-go-on-a-diet-88l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l><span>How to Make Your Docker Images Go on a Diet ğŸŠâ€â™‚ï¸</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea-li><a href=/blog/a-quick-navigation-through-service-mesh-in-kubernetes-5dea/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea><span>A quick navigation through Service Mesh in Kubernetes ğŸ‘€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o-li><a href=/blog/kubernetes-rbac-and-role-aggregation-made-easy-3j4o/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o><span>ğŸš€ Kubernetes RBAC and Role Aggregation Made Easy</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54-li><a href=/blog/essential-tips-for-setting-resource-limits-in-kubernetes-3b54/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54><span>Essential Tips for Setting Resource Limits in Kubernetes ğŸ“ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3-li><a href=/blog/kubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3><span>ğŸŒ Kubernetes DNS: How to Use In-Cluster and Azure Private DNS Together</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33-li><a href=/blog/how-to-manage-kubernetes-app-storage-like-a-pro-o33/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33><span>How to Manage Kubernetes App Storage Like a Pro ğŸ“</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2-li><a href=/blog/understanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2><span>Understanding Pod Topology Spread Constraints and Node Affinity in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec-li><a href=/blog/how-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec><span>How to Test the Latest Kubernetes Changes in Version 1.31 "Elli"</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubermates-org/kubermates-site/tree/main/content/blog/2024-09-12-monitor-and-optimize-multi-cluster-aks-costs-4627.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/kubermates-org/kubermates-site/edit/main/content/blog/2024-09-12-monitor-and-optimize-multi-cluster-aks-costs-4627.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubermates-org/kubermates-site/new/main/content/blog?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/kubermates-org/kubermates-site/issues/new?title=Monitor%20and%20Optimize%20Multi-Cluster%20AKS%20Costs%20%f0%9f%92%b0" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#what-is-kubecost->What is KubeCost? ğŸ§®</a></li><li><a href=#why-use-aks-fleet-manager->Why Use AKS Fleet Manager? ğŸŒ</a></li><li><a href=#why-use-opentelemetry-managed-prometheus-and-grafana->Why Use OpenTelemetry, Managed Prometheus, and Grafana? ğŸ“Š</a></li><li><a href=#step-by-step-deploy-kubecost-and-opentelemetry-with-aks-fleet-manager->Step-by-Step: Deploy KubeCost and OpenTelemetry with AKS Fleet Manager ğŸ”§</a><ul><li><a href=#step-1-create-and-register-aks-clusters>Step 1: Create and Register AKS Clusters</a></li><li><a href=#step-2-create-helmrelease-manifests-for-kubecost-and-opentelemetry>Step 2: Create HelmRelease Manifests for KubeCost and OpenTelemetry</a></li><li><a href=#step-3-create-a-clusterresourceplacement-to-distribute-helmreleases>Step 3: Create a ClusterResourcePlacement to Distribute HelmReleases</a></li><li><a href=#step-4-apply-these-resources-to-your-fleet-manager>Step 4: Apply These Resources to Your Fleet Manager</a></li><li><a href=#step-5-configure-microsoft-managed-prometheus>Step 5: Configure Microsoft Managed Prometheus</a></li><li><a href=#step-6-set-up-centralized-visualization-in-managed-grafana>Step 6: Set Up Centralized Visualization in Managed Grafana</a></li><li><a href=#step-7-monitor-and-analyze-costs-across-clusters->Step 7: Monitor and Analyze Costs Across Clusters ğŸ“ˆ</a></li><li><a href=#step-8-implement-best-practices-for-security-and-performance->Step 8: Implement Best Practices for Security and Performance ğŸ”’</a></li></ul></li><li><a href=#conclusion->Conclusion ğŸ¯</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/announcement/ data-taxonomy-term=announcement><span class=taxonomy-label>Announcement</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/automation/ data-taxonomy-term=automation><span class=taxonomy-label>Automation</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span><span class=taxonomy-count>13</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cicd/ data-taxonomy-term=cicd><span class=taxonomy-label>Cicd</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span><span class=taxonomy-count>28</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloudnative/ data-taxonomy-term=cloudnative><span class=taxonomy-label>Cloudnative</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cncf/ data-taxonomy-term=cncf><span class=taxonomy-label>Cncf</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/community/ data-taxonomy-term=community><span class=taxonomy-label>Community</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/containers/ data-taxonomy-term=containers><span class=taxonomy-label>Containers</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/devops/ data-taxonomy-term=devops><span class=taxonomy-label>Devops</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>Docker</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/falco/ data-taxonomy-term=falco><span class=taxonomy-label>Falco</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/finops/ data-taxonomy-term=finops><span class=taxonomy-label>Finops</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>Github</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/githubactions/ data-taxonomy-term=githubactions><span class=taxonomy-label>Githubactions</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/gitops/ data-taxonomy-term=gitops><span class=taxonomy-label>Gitops</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/karmada/ data-taxonomy-term=karmada><span class=taxonomy-label>Karmada</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span><span class=taxonomy-count>29</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/networking/ data-taxonomy-term=networking><span class=taxonomy-label>Networking</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/opensource/ data-taxonomy-term=opensource><span class=taxonomy-label>Opensource</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/platform-engineering/ data-taxonomy-term=platform-engineering><span class=taxonomy-label>Platform-Engineering</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/productivity/ data-taxonomy-term=productivity><span class=taxonomy-label>Productivity</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/programming/ data-taxonomy-term=programming><span class=taxonomy-label>Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/servicemesh/ data-taxonomy-term=servicemesh><span class=taxonomy-label>Servicemesh</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terraform/ data-taxonomy-term=terraform><span class=taxonomy-label>Terraform</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terragrunt/ data-taxonomy-term=terragrunt><span class=taxonomy-label>Terragrunt</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/trivy/ data-taxonomy-term=trivy><span class=taxonomy-label>Trivy</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/blog/>Blogs</a></li><li class="breadcrumb-item active" aria-current=page>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°</li></ol></nav><div class=td-content><h1>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°</h1><div class=lead>As businesses scale their Kubernetes workloads across multiple Azure Kubernetes Service (AKS)&mldr;</div><div class="td-byline mb-4"><time datetime=2024-09-12 class=text-body-secondary>Thursday, September 12, 2024</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/finops/ data-taxonomy-term=finops><span class=taxonomy-label>Finops</span></a></li></ul></div></header><p>As businesses scale their Kubernetes workloads across multiple Azure Kubernetes Service (AKS) clusters, managing and optimizing cloud costs becomes critical. Deploying and managing observability tools such as KubeCost and OpenTelemetry (OTel) across multiple clusters can be simplified using <a href=https://github.com/Azure/fleet/blob/main/docs/concepts/README.md>AKS Fleet Manager</a>, Microsoft Managed Prometheus, and Grafana.</p><p>This guide will explain how to:</p><ol><li>Deploy <strong>KubeCost</strong> and <strong>OpenTelemetry</strong> across multiple AKS clusters using <strong>AKS Fleet Manager</strong>.</li><li>Expose metrics through OpenTelemetry.</li><li>Centralize monitoring via <strong>Managed Prometheus</strong> and <strong>Grafana</strong>.</li></ol><p>Youâ€™ll gain a single-pane-of-glass view into your multi-cluster environment, enabling more efficient resource utilization and cost management.</p><h2 id=what-is-kubecost->What is KubeCost? ğŸ§®</h2><p><strong>KubeCost</strong> is an open-source cost management tool that provides real-time visibility into your Kubernetes spend. It gives a granular breakdown (namespaces, deployments, services, pods) so you can optimize resource usage and reduce expenses.</p><h2 id=why-use-aks-fleet-manager->Why Use AKS Fleet Manager? ğŸŒ</h2><p><a href=https://github.com/Azure/fleet/blob/main/docs/concepts/README.md><strong>AKS Fleet Manager</strong></a> simplifies multi-cluster Kubernetes management by providing a centralized way to define governance, policies, and monitoring. Instead of manually configuring each cluster, you can orchestrate deployments (like KubeCost and OpenTelemetry) across multiple AKS clusters at once.</p><h2 id=why-use-opentelemetry-managed-prometheus-and-grafana->Why Use OpenTelemetry, Managed Prometheus, and Grafana? ğŸ“Š</h2><ul><li><strong>OpenTelemetry (OTel)</strong>: Standardizes observability, collecting metrics, logs, and traces from Kubernetes workloads and exposing them to monitoring systems (like Prometheus).</li><li><strong>Microsoft Managed Prometheus</strong>: A fully managed Prometheus service that removes the overhead of maintaining Prometheus infrastructure.</li><li><strong>Grafana</strong>: A robust visualization tool that integrates with Prometheus to present metrics in customizable dashboards.</li></ul><p>Using these in conjunction with AKS Fleet Manager allows you to centrally monitor, troubleshoot, and optimize costs across your entire AKS fleet.</p><h2 id=step-by-step-deploy-kubecost-and-opentelemetry-with-aks-fleet-manager->Step-by-Step: Deploy KubeCost and OpenTelemetry with AKS Fleet Manager ğŸ”§</h2><h3 id=step-1-create-and-register-aks-clusters>Step 1: Create and Register AKS Clusters</h3><ol><li><strong>Create your AKS clusters</strong> (using CLI or Portal).</li><li><strong>Register each AKS cluster</strong> with AKS Fleet Manager. (See also: <a href=https://github.com/Azure/fleet/blob/main/docs/concepts/MemberCluster/README.md>MemberCluster docs</a>)</li></ol><h4 id=11-create-aks-clusters>1.1 Create AKS Clusters</h4><p>Example using the Azure CLI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Create a resource group for AKS Fleet Manager</span>
</span></span><span style=display:flex><span>az group create --name myFleetResourceGroup --location eastus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create two AKS clusters in different resource groups</span>
</span></span><span style=display:flex><span>az aks create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group myResourceGroup1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name myAKSCluster1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --node-count <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --enable-managed-identity <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --generate-ssh-keys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az aks create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group myResourceGroup2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name myAKSCluster2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --node-count <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --enable-managed-identity <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --generate-ssh-keys
</span></span></code></pre></div><h4 id=12-register-clusters-with-aks-fleet-manager>1.2 Register Clusters with AKS Fleet Manager</h4><p>Once your clusters are ready, register them with your existing Fleet Manager instance:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Register the first AKS cluster with Fleet Manager</span>
</span></span><span style=display:flex><span>az fleet member create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group myFleetResourceGroup <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --fleet-name myFleetManager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name myAKSCluster1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --member-cluster-id /subscriptions/<span style=color:#f92672>{</span>subscription-id<span style=color:#f92672>}</span>/resourceGroups/myResourceGroup1/providers/Microsoft.ContainerService/managedClusters/myAKSCluster1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Register the second AKS cluster</span>
</span></span><span style=display:flex><span>az fleet member create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group myFleetResourceGroup <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --fleet-name myFleetManager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name myAKSCluster2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --member-cluster-id /subscriptions/<span style=color:#f92672>{</span>subscription-id<span style=color:#f92672>}</span>/resourceGroups/myResourceGroup2/providers/Microsoft.ContainerService/managedClusters/myAKSCluster2
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: Replace <code>{subscription-id}</code> with your actual subscription ID.</p></blockquote><h3 id=step-2-create-helmrelease-manifests-for-kubecost-and-opentelemetry>Step 2: Create HelmRelease Manifests for KubeCost and OpenTelemetry</h3><p>AKS Fleet Manager uses Flux-like semantics for delivering resources to your member clusters. You can define <strong>HelmRelease</strong> manifests to install KubeCost and the OTel Collector and then use <a href=https://github.com/Azure/fleet/blob/main/docs/concepts/ClusterResourcePlacement/README.md><strong>ClusterResourcePlacement</strong></a> to distribute them to your clusters.</p><h4 id=21-define-a-helmrelease-for-kubecost>2.1 Define a HelmRelease for KubeCost</h4><p>Create a file named <code>kubecost-helmrelease.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>helm.toolkit.fluxcd.io/v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HelmRelease</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kubecost</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kubecost</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>releaseName</span>: <span style=color:#ae81ff>kubecost</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>chart</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>https://kubecost.github.io/cost-analyzer/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cost-analyzer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>1.90.1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>install</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>createNamespace</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubecostProductConfigs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>prometheus</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networkPolicy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>This HelmRelease configures KubeCost in a <code>kubecost</code> namespace.</p><h4 id=22-define-a-helmrelease-for-opentelemetry>2.2 Define a HelmRelease for OpenTelemetry</h4><p>Create a file named <code>otel-collector-helmrelease.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>helm.toolkit.fluxcd.io/v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HelmRelease</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>otel-collector</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>otel-collector</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>releaseName</span>: <span style=color:#ae81ff>otel-collector</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>chart</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>https://open-telemetry.github.io/opentelemetry-helm-charts</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>opentelemetry-collector</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>0.31.0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>install</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>createNamespace</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;kubecost&#39;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>metrics_path</span>: <span style=color:#ae81ff>/metrics</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>                - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;kubecost-cost-analyzer.kubecost.svc.cluster.local:9090&#39;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>exporters</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>otlp</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>endpoint</span>: <span style=color:#e6db74>&#34;managed-prometheus-endpoint:4317&#34;</span>  <span style=color:#75715e># Update with your actual endpoint</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>insecure</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>pipelines</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>metrics</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>receivers</span>: [<span style=color:#ae81ff>prometheus]</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>exporters</span>: [<span style=color:#ae81ff>otlp]</span>
</span></span></code></pre></div><p>This config sets up the OpenTelemetry Collector to scrape metrics from KubeCost and forward them to your Managed Prometheus endpoint.</p><h3 id=step-3-create-a-clusterresourceplacement-to-distribute-helmreleases>Step 3: Create a ClusterResourcePlacement to Distribute HelmReleases</h3><p>Now that you have your HelmReleases defined, use a <strong>ClusterResourcePlacement</strong> to distribute them to the clusters managed by AKS Fleet Manager. (See also: <a href=https://github.com/Azure/fleet/blob/main/docs/concepts/ClusterResourcePlacement/README.md>ClusterResourcePlacement docs</a>)</p><p>Create a file named <code>crp-kubecost-otel.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>fleet.azure.com/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterResourcePlacement</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cost-and-otel-placement</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Select all clusters in your Fleet, or specify labels under &#39;matchLabels&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>clusterSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>: {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># (Optional) Additional policy or scheduling parameters can go here</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># policy:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resourceSelectors</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Reference the KubeCost HelmRelease</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HelmRelease</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>helm.toolkit.fluxcd.io/v2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kubecost</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kubecost</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Reference the OTel HelmRelease</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HelmRelease</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>helm.toolkit.fluxcd.io/v2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>otel-collector</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>otel-collector</span>
</span></span></code></pre></div><h3 id=step-4-apply-these-resources-to-your-fleet-manager>Step 4: Apply These Resources to Your Fleet Manager</h3><p>You can now apply these files to the <strong>Fleet Manager</strong> cluster, which is typically the control plane for your multi-cluster environment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Apply the HelmRelease for KubeCost</span>
</span></span><span style=display:flex><span>kubectl apply -f kubecost-helmrelease.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Apply the HelmRelease for OTel Collector</span>
</span></span><span style=display:flex><span>kubectl apply -f otel-collector-helmrelease.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Apply the ClusterResourcePlacement</span>
</span></span><span style=display:flex><span>kubectl apply -f crp-kubecost-otel.yaml
</span></span></code></pre></div><p>AKS Fleet Manager will propagate these HelmReleases to each selected cluster (based on the <code>clusterSelector</code>) and install KubeCost and OpenTelemetry automatically.</p><h3 id=step-5-configure-microsoft-managed-prometheus>Step 5: Configure Microsoft Managed Prometheus</h3><p>With the OpenTelemetry Collector set up in each cluster, Managed Prometheus will receive metrics from the OTLP endpoint.</p><ol><li>In the <strong>Azure Portal</strong>, go to <strong>Monitoring</strong> > <strong>Metrics</strong> in each AKS cluster.</li><li><strong>Enable Managed Prometheus</strong> for each cluster.</li></ol><p>Once enabled, your Managed Prometheus instance will begin receiving metrics from each cluster via OpenTelemetry.</p><h3 id=step-6-set-up-centralized-visualization-in-managed-grafana>Step 6: Set Up Centralized Visualization in Managed Grafana</h3><p>To visualize metrics and costs across your AKS fleet, set up Managed Grafana to connect to Managed Prometheus.</p><ol><li><p><strong>Create a Managed Grafana Workspace</strong></p><ul><li>In the Azure portal, navigate to <strong>Azure Managed Grafana</strong> and create a workspace.</li></ul></li><li><p><strong>Add a Prometheus Data Source</strong></p><ul><li>In the Grafana instance, go to <strong>Configuration</strong> > <strong>Data Sources</strong>.</li><li>Add <strong>Prometheus</strong> as a data source and provide the Managed Prometheus endpoint URL.</li></ul></li><li><p><strong>Import KubeCost Dashboards</strong></p><ul><li>In Grafana, go to <strong>Dashboards</strong> > <strong>Manage</strong> > <strong>Import</strong>.</li><li>Use KubeCostâ€™s provided dashboard IDs or JSON files to import their predefined dashboards for cost analysis.</li></ul></li></ol><h3 id=step-7-monitor-and-analyze-costs-across-clusters->Step 7: Monitor and Analyze Costs Across Clusters ğŸ“ˆ</h3><p>With everything configured, you can now:</p><ul><li><strong>View Cost Allocations</strong> by namespaces, deployments, or pods using KubeCost metrics.</li><li><strong>Track Metrics</strong> (CPU, memory, etc.) from all clusters in a single Grafana instance.</li><li><strong>Identify Inefficiencies</strong> and optimize resource usage using dashboards and Prometheus queries.</li></ul><p>Example PromQL query for <strong>cost allocation by namespace</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#66d9ef>sum</span><span style=color:#f92672>(</span>kubecost_allocation{label_namespace<span style=color:#f92672>!=</span>&#34;&#34;}<span style=color:#f92672>)</span> <span style=color:#66d9ef>by</span> <span style=color:#f92672>(</span>label_namespace<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Example PromQL query for <strong>cross-cluster cost efficiency by deployment</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#66d9ef>sum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>kubecost_allocation{label_deployment<span style=color:#f92672>!=</span>&#34;&#34;}[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>))</span> <span style=color:#66d9ef>by</span> <span style=color:#f92672>(</span>label_deployment, cluster<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>/</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>sum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>container_cpu_usage_seconds_total{job<span style=color:#f92672>=</span>&#34;<span style=color:#e6db74>kubelet</span>&#34;, container<span style=color:#f92672>!=</span>&#34;<span style=color:#e6db74>POD</span>&#34;}[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>))</span> <span style=color:#66d9ef>by</span> <span style=color:#f92672>(</span>pod, namespace, cluster<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=step-8-implement-best-practices-for-security-and-performance->Step 8: Implement Best Practices for Security and Performance ğŸ”’</h3><ul><li><strong>Enable TLS</strong> for communication between OpenTelemetry Collectors and Managed Prometheus (remove <code>insecure: true</code> in production).</li><li><strong>Limit Network Access</strong> to ensure that only authorized users and systems can access Prometheus and Grafana endpoints.</li><li><strong>Set Resource Limits</strong> on your OpenTelemetry Collectors and KubeCost Pods to prevent resource overuse.</li></ul><h2 id=conclusion->Conclusion ğŸ¯</h2><p>By leveraging <a href=https://github.com/Azure/fleet/blob/main/docs/concepts/README.md><strong>AKS Fleet Manager</strong></a> with <a href=https://github.com/Azure/fleet/blob/main/docs/concepts/ClusterResourcePlacement/README.md><strong>ClusterResourcePlacement</strong></a> to distribute HelmReleases for <strong>KubeCost</strong> and <strong>OpenTelemetry</strong>, and centralizing metrics in <strong>Managed Prometheus</strong> and <strong>Grafana</strong>, youâ€™ll streamline cost management and observability across multiple AKS clusters.</p><ul><li><strong>Single-Pane Monitoring</strong>: All cost and performance data in one place.</li><li><strong>Simplicity at Scale</strong>: AKS Fleet Manager handles deploying resources to multiple clusters.</li><li><strong>Actionable Insights</strong>: Use Grafana dashboards to pinpoint inefficiencies and optimize usage.</li></ul><p>Start implementing this multi-cluster monitoring solution today to gain comprehensive control over your Kubernetes spending!</p><p><strong>Happy clustering!</strong> ğŸŒŸ</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/enhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida/ aria-label="Previous - ğŸš€ Enhancing Container Security: The Complete Guide to Secure and Clean Kubernetes Clusters ğŸ›¡ï¸ğŸ§¼" class="btn btn-primary"><span class=me-1>â†</span>Previous</a></li><li><a href=/blog/upgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap/ aria-label="Next - Upgrading AKS: In-Place, Blue-Green, and Canary Upgrades Explained ğŸš€" class="btn btn-primary">Next<span class=ms-1>â†’</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Kubermates powered by Kapheira</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.d844e8cb3c2d74f005336b0c873045728e53ff0ce5534c7d8563fa0676a87b08.js integrity="sha256-2EToyzwtdPAFM2sMhzBFco5T/wzlU0x9hWP6Bnaoewg=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>