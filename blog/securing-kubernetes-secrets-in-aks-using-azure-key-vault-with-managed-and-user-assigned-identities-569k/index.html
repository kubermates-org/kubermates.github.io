<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€ | Kubermates</title><meta name=description content="Hello Kubernetes enthusiast! ğŸ‘‹ Letâ€™s dive into a critical aspect of securing your applications..."><meta property="og:url" content="https://kubermates.org/blog/securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k/"><meta property="og:site_name" content="Kubermates"><meta property="og:title" content="ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€"><meta property="og:description" content="Hello Kubernetes enthusiast! ğŸ‘‹ Letâ€™s dive into a critical aspect of securing your applications..."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-09-04T11:35:22+00:00"><meta property="article:modified_time" content="2024-09-04T11:35:22+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Cloud"><meta property="article:tag" content="Security"><meta itemprop=name content="ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€"><meta itemprop=description content="Hello Kubernetes enthusiast! ğŸ‘‹ Letâ€™s dive into a critical aspect of securing your applications..."><meta itemprop=datePublished content="2024-09-04T11:35:22+00:00"><meta itemprop=dateModified content="2024-09-04T11:35:22+00:00"><meta itemprop=wordCount content="1400"><meta itemprop=keywords content="Kubernetes,Azure,Cloud,Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€"><meta name=twitter:description content="Hello Kubernetes enthusiast! ğŸ‘‹ Letâ€™s dive into a critical aspect of securing your applications..."><link rel=preload href=/scss/main.min.f21cdd215205aa393cb73e4e99d80ac2f637aa8b405381de7006586191c98d17.css as=style integrity="sha256-8hzdIVIFqjk8tz5OmdgKwvY3qotAU4HecAZYYZHJjRc=" crossorigin=anonymous><link href=/scss/main.min.f21cdd215205aa393cb73e4e99d80ac2f637aa8b405381de7006586191c98d17.css rel=stylesheet integrity="sha256-8hzdIVIFqjk8tz5OmdgKwvY3qotAU4HecAZYYZHJjRc=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=theme-color content="#00D1B2"></head><body class="td-page td-blog"><header><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container-fluid><a class=navbar-brand href=https://kubermates.org/><img src=/images/nav-logo-white.png srcset="/images/nav-logo-white.png 1x, /images/nav-logo-white@2x.png 2x" alt=Kubermates width=auto height=48>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ms-auto mb-2 mb-lg-0"><li class=nav-item><a class=nav-link href=/blog/>Articles</a></li><li class=nav-item><a class=nav-link href=/events/>Events</a></li><li class=nav-item><a class=nav-link href=/docs/>Docs</a></li><li class=nav-item><a class=nav-link href=/releases/>Releases</a></li><li class=nav-item><a class=nav-link href=/contribute/>Contribute</a></li></ul></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogfirst-post-li><a href=/blog/first-post/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogfirst-post><span>launching kubermates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih-li><a href=/blog/github-actions-composite-vs-reusable-workflows-4bih/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih><span>ğŸ§© GitHub Actions Composite vs Reusable Workflows</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc-li><a href=/blog/elevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc><span>ğŸš€ğŸŒ Elevating Infrastructure: From Terraform/Terragrunt Foundations to Platform Engineering ğŸ˜Š</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-helm-1940-li><a href=/blog/secure-secret-management-with-sops-in-helm-1940/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-helm-1940><span>ğŸ” Secure Secret Management with SOPS in Helm ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a-li><a href=/blog/secure-secret-management-with-sops-in-terraform-terragrunt-231a/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a><span>ğŸ” Secure Secret Management with SOPS in Terraform & Terragrunt</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca-li><a href=/blog/helm-chart-essentials-writing-effective-charts-11ca/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca><span>Helm Chart Essentials & Writing Effective Charts ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89-li><a href=/blog/unlocking-secrets-with-external-secrets-operator-2f89/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89><span>Unlocking Secrets with External Secrets Operator ğŸ”âœ¨</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk-li><a href=/blog/automating-dns-in-azure-private-dns-with-external-dns-3knk/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk><span>Automating DNS in Azure Private DNS with External-DNS â˜ï¸ğŸ”</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh-li><a href=/blog/using-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh><span>Using Nginx Ingress Controller and Cert-Manager for HTTPS with Letâ€™s Encrypt âš¡</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0-li><a href=/blog/ensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0><span>Ensuring Effective Helm Charts with Linting, Testing, and Diff Checks ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5-li><a href=/blog/capsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5><span>Capsule: How to Use It and First Steps to Set It Up on an AKS Cluster ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh-li><a href=/blog/understanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh><span>Understanding AKS NAP: Azure Kubernetes Service Node Auto-Provisioning (Powered by Karpenter) ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d-li><a href=/blog/admission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d><span>Admission Controllers in Kubernetes: OPA GateKeeper, Kyverno, and Azure Policy Add-on for AKSâ€”Which One Wins? ğŸ†</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap-li><a href=/blog/upgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap><span>Upgrading AKS: In-Place, Blue-Green, and Canary Upgrades Explained ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627-li><a href=/blog/monitor-and-optimize-multi-cluster-aks-costs-4627/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627><span>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida-li><a href=/blog/enhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida><span>ğŸš€ Enhancing Container Security: The Complete Guide to Secure and Clean Kubernetes Clusters ğŸ›¡ï¸ğŸ§¼</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08-li><a href=/blog/karmada-deep-dive-into-managing-multiple-aks-clusters-1j08/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08><span>Karmada: Deep Dive into Managing Multiple AKS Clusters ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99-li><a href=/blog/understanding-ebpf-and-its-application-in-modern-cloud-environments-3f99/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99><span>Understanding eBPF and Its Application in Modern Cloud Environments ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k-li><a href=/blog/securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k><span class=td-sidebar-nav-active-item>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l-li><a href=/blog/automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l><span>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo-li><a href=/blog/autoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo><span>Autoscaling in Kubernetes: KEDA, Karpenter, and Native Autoscalers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g-li><a href=/blog/insights-on-securing-your-kubernetes-cluster-with-falco-4b9g/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g><span>Insights on Securing Your Kubernetes Cluster with Falco ğŸš€ğŸ”’</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil-li><a href=/blog/building-a-kubernetes-operator-with-an-nginx-crd-3lil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil><span>ğŸš€ Building a Kubernetes Operator with an NGINX CRD</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l-li><a href=/blog/hacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l><span>ğŸ¨ Hacking the Helm Operator with Flux: Creating Self-Installable Services for Easier App Deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogchaos-engineering-lets-break-everything-io0-li><a href=/blog/chaos-engineering-lets-break-everything-io0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogchaos-engineering-lets-break-everything-io0><span>Chaos Engineering Let's Break Everything! ğŸ˜ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017-li><a href=/blog/a-guide-to-modern-kubernetes-service-networking-4017/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017><span>A Guide to Modern Kubernetes Service Networking ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge-li><a href=/blog/effective-vulnerability-monitoring-in-kubernetes-1mge/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge><span>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-multi-cluster-management-1nek-li><a href=/blog/kubernetes-multi-cluster-management-1nek/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-multi-cluster-management-1nek><span>Kubernetes Multi-Cluster Management ğŸ“¦</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l-li><a href=/blog/how-to-make-your-docker-images-go-on-a-diet-88l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l><span>How to Make Your Docker Images Go on a Diet ğŸŠâ€â™‚ï¸</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea-li><a href=/blog/a-quick-navigation-through-service-mesh-in-kubernetes-5dea/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea><span>A quick navigation through Service Mesh in Kubernetes ğŸ‘€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o-li><a href=/blog/kubernetes-rbac-and-role-aggregation-made-easy-3j4o/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o><span>ğŸš€ Kubernetes RBAC and Role Aggregation Made Easy</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54-li><a href=/blog/essential-tips-for-setting-resource-limits-in-kubernetes-3b54/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54><span>Essential Tips for Setting Resource Limits in Kubernetes ğŸ“ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3-li><a href=/blog/kubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3><span>ğŸŒ Kubernetes DNS: How to Use In-Cluster and Azure Private DNS Together</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33-li><a href=/blog/how-to-manage-kubernetes-app-storage-like-a-pro-o33/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33><span>How to Manage Kubernetes App Storage Like a Pro ğŸ“</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2-li><a href=/blog/understanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2><span>Understanding Pod Topology Spread Constraints and Node Affinity in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec-li><a href=/blog/how-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec><span>How to Test the Latest Kubernetes Changes in Version 1.31 "Elli"</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubermates-org/kubermates-site/tree/main/content/blog/2024-09-04-securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/kubermates-org/kubermates-site/edit/main/content/blog/2024-09-04-securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubermates-org/kubermates-site/new/main/content/blog?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/kubermates-org/kubermates-site/issues/new?title=%f0%9f%8c%90%20Securing%20Kubernetes%20Secrets%20in%20AKS:%20Using%20Azure%20Key%20Vault%20with%20Managed%20and%20User%20Assigned%20Identities%20%f0%9f%9a%80" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#why-not-just-use-kubernetes-secrets->Why Not Just Use Kubernetes Secrets? ğŸ¤”</a></li><li><a href=#step-1-enabling-the-secret-store-csi-driver-in-aks->Step 1: Enabling the Secret Store CSI Driver in AKS ğŸ› ï¸</a><ul><li><a href=#enabling-the-secret-store-csi-driver-in-aks>Enabling the Secret Store CSI Driver in AKS</a></li></ul></li><li><a href=#method-1-securing-secrets-with-azure-key-vault-using-vm-managed-identity->Method 1: Securing Secrets with Azure Key Vault Using VM Managed Identity ğŸ”</a><ul><li><a href=#understanding-vm-managed-identities->Understanding VM Managed Identities ğŸ¤–</a></li><li><a href=#step-2-set-up-azure-key-vault->Step 2: Set Up Azure Key Vault â˜ï¸</a></li><li><a href=#step-3-grant-access-to-the-vm-managed-identity->Step 3: Grant Access to the VM Managed Identity ğŸ¤–</a></li><li><a href=#step-4-configure-and-deploy-to-kubernetes->Step 4: Configure and Deploy to Kubernetes ğŸš€</a></li><li><a href=#step-5-access-your-secrets->Step 5: Access Your Secrets ğŸ‰</a></li></ul></li><li><a href=#method-2-securing-secrets-with-azure-key-vault-using-user-assigned-identity->Method 2: Securing Secrets with Azure Key Vault Using User Assigned Identity ğŸ”</a><ul><li><a href=#understanding-user-assigned-identities->Understanding User Assigned Identities ğŸ¤”</a></li><li><a href=#step-2-set-up-azure-key-vault--1>Step 2: Set Up Azure Key Vault â˜ï¸</a></li><li><a href=#step-3-set-up-a-user-assigned-managed-identity->Step 3: Set Up a User Assigned Managed Identity ğŸ”§</a></li><li><a href=#step-4-configure-and-deploy-to-kubernetes--1>Step 4: Configure and Deploy to Kubernetes ğŸš€</a></li><li><a href=#step-5-access-your-secrets--1>Step 5: Access Your Secrets ğŸ‰</a></li></ul></li><li><a href=#wrapping-it-up->Wrapping It Up ğŸ</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/announcement/ data-taxonomy-term=announcement><span class=taxonomy-label>Announcement</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/automation/ data-taxonomy-term=automation><span class=taxonomy-label>Automation</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>16</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span><span class=taxonomy-count>13</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cicd/ data-taxonomy-term=cicd><span class=taxonomy-label>Cicd</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span><span class=taxonomy-count>28</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud-foundation/ data-taxonomy-term=cloud-foundation><span class=taxonomy-label>Cloud-Foundation</span><span class=taxonomy-count>29</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloudnative/ data-taxonomy-term=cloudnative><span class=taxonomy-label>Cloudnative</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cncf/ data-taxonomy-term=cncf><span class=taxonomy-label>Cncf</span><span class=taxonomy-count>146</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/community/ data-taxonomy-term=community><span class=taxonomy-label>Community</span><span class=taxonomy-count>51</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/containers/ data-taxonomy-term=containers><span class=taxonomy-label>Containers</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/devops/ data-taxonomy-term=devops><span class=taxonomy-label>Devops</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>Docker</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/eks/ data-taxonomy-term=eks><span class=taxonomy-label>Eks</span><span class=taxonomy-count>45</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/event/ data-taxonomy-term=event><span class=taxonomy-label>Event</span><span class=taxonomy-count>128</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/falco/ data-taxonomy-term=falco><span class=taxonomy-label>Falco</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/finops/ data-taxonomy-term=finops><span class=taxonomy-label>Finops</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>Github</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/githubactions/ data-taxonomy-term=githubactions><span class=taxonomy-label>Githubactions</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/gitops/ data-taxonomy-term=gitops><span class=taxonomy-label>Gitops</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/gke/ data-taxonomy-term=gke><span class=taxonomy-label>Gke</span><span class=taxonomy-count>40</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/grafana/ data-taxonomy-term=grafana><span class=taxonomy-label>Grafana</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/jenkins-x/ data-taxonomy-term=jenkins-x><span class=taxonomy-label>Jenkins-X</span><span class=taxonomy-count>50</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/k3s/ data-taxonomy-term=k3s><span class=taxonomy-label>K3s</span><span class=taxonomy-count>21</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/karmada/ data-taxonomy-term=karmada><span class=taxonomy-label>Karmada</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kodekloud/ data-taxonomy-term=kodekloud><span class=taxonomy-label>Kodekloud</span><span class=taxonomy-count>16</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kubeflow/ data-taxonomy-term=kubeflow><span class=taxonomy-label>Kubeflow</span><span class=taxonomy-count>10</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span><span class=taxonomy-count>351</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/networking/ data-taxonomy-term=networking><span class=taxonomy-label>Networking</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/nirmata/ data-taxonomy-term=nirmata><span class=taxonomy-label>Nirmata</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/openshift/ data-taxonomy-term=openshift><span class=taxonomy-label>Openshift</span><span class=taxonomy-count>18</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/opensource/ data-taxonomy-term=opensource><span class=taxonomy-label>Opensource</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/productivity/ data-taxonomy-term=productivity><span class=taxonomy-label>Productivity</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/programming/ data-taxonomy-term=programming><span class=taxonomy-label>Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rancher/ data-taxonomy-term=rancher><span class=taxonomy-label>Rancher</span><span class=taxonomy-count>32</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rke/ data-taxonomy-term=rke><span class=taxonomy-label>Rke</span><span class=taxonomy-count>12</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rke2/ data-taxonomy-term=rke2><span class=taxonomy-label>Rke2</span><span class=taxonomy-count>26</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/rss/ data-taxonomy-term=rss><span class=taxonomy-label>Rss</span><span class=taxonomy-count>10</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>17</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/servicemesh/ data-taxonomy-term=servicemesh><span class=taxonomy-label>Servicemesh</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terraform/ data-taxonomy-term=terraform><span class=taxonomy-label>Terraform</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terragrunt/ data-taxonomy-term=terragrunt><span class=taxonomy-label>Terragrunt</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/tigera/ data-taxonomy-term=tigera><span class=taxonomy-label>Tigera</span><span class=taxonomy-count>20</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/trivy/ data-taxonomy-term=trivy><span class=taxonomy-label>Trivy</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/vmware/ data-taxonomy-term=vmware><span class=taxonomy-label>Vmware</span><span class=taxonomy-count>29</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/blog/>Blogs</a></li><li class="breadcrumb-item active" aria-current=page>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€</li></ol></nav><div class=td-content><h1>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€</h1><div class=lead>Hello Kubernetes enthusiast! ğŸ‘‹ Letâ€™s dive into a critical aspect of securing your applications&mldr;</div><div class="td-byline mb-4"><time datetime=2024-09-04 class=text-body-secondary>Wednesday, September 04, 2024</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span></a></li></ul></div></header><p>Hello Kubernetes enthusiast! ğŸ‘‹ Letâ€™s dive into a critical aspect of securing your applications running in Azure Kubernetes Service (AKS): managing secrets. While Kubernetes Secrets provide a way to manage sensitive information like passwords and API keys, they arenâ€™t encrypted by default and can be vulnerable if not handled correctly. In this guide, we&rsquo;ll explore how to securely manage secrets by integrating Azure Key Vault with AKS using both <strong>VM Managed Identities</strong> and <strong>User Assigned Identities</strong>. Plus, we&rsquo;ll show you how to enable the Secret Store CSI Driver directly in AKS.</p><h2 id=why-not-just-use-kubernetes-secrets->Why Not Just Use Kubernetes Secrets? ğŸ¤”</h2><p>Kubernetes Secrets are only base64-encoded, not encrypted. This means if someone gains access to your Kubernetes cluster or its etcd database, they could easily decode and retrieve your sensitive information. Therefore, itâ€™s recommended to use an external secrets management service like <a href=https://learn.microsoft.com/en-us/azure/key-vault/general/overview>Azure Key Vault</a>, which offers robust security features and integrates seamlessly with AKS.</p><h2 id=step-1-enabling-the-secret-store-csi-driver-in-aks->Step 1: Enabling the Secret Store CSI Driver in AKS ğŸ› ï¸</h2><p>Before diving into examples, letâ€™s enable the Secret Store CSI Driver in AKS. Azure makes this integration straightforward by allowing you to enable the Secret Store CSI Driver directly on your AKS cluster.</p><h3 id=enabling-the-secret-store-csi-driver-in-aks>Enabling the Secret Store CSI Driver in AKS</h3><ol><li><strong>Enable the Azure Key Vault Provider for Secrets Store CSI Driver</strong> during AKS cluster creation or by updating an existing cluster:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az aks update -n MyAKSCluster -g MyResourceGroup --enable-secret-store-csi-driver
</span></span></code></pre></div><p>This command enables the Secrets Store CSI Driver and installs the necessary components in your AKS cluster.</p><ul><li>Learn more about enabling the <a href=https://learn.microsoft.com/en-us/azure/aks/csi-secrets-store-driver>Secrets Store CSI Driver</a> in AKS.</li></ul><ol start=2><li><strong>Verify Installation</strong>:</li></ol><p>After enabling the feature, you can verify the installation by checking the pods in the <code>kube-system</code> namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods -n kube-system
</span></span></code></pre></div><p>You should see pods related to the CSI driver running.</p><h2 id=method-1-securing-secrets-with-azure-key-vault-using-vm-managed-identity->Method 1: Securing Secrets with Azure Key Vault Using VM Managed Identity ğŸ”</h2><h3 id=understanding-vm-managed-identities->Understanding VM Managed Identities ğŸ¤–</h3><p><strong>VM Managed Identities</strong> (also known as <strong>System-Assigned Managed Identities</strong>) are automatically created by Azure when you enable a managed identity on a virtual machine or an AKS cluster. This identity is tied to the lifecycle of the VM or AKS cluster, meaning it will be deleted if the resource is deleted. VM Managed Identities are convenient because they donâ€™t require any manual management of credentials. Azure handles the authentication process automatically, which simplifies securing access to resources like Azure Key Vault.</p><ul><li>Learn more about <a href=https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview>Managed Identities for Azure Resources</a>.</li></ul><h3 id=step-2-set-up-azure-key-vault->Step 2: Set Up Azure Key Vault â˜ï¸</h3><p>Letâ€™s start by creating an Azure Key Vault and adding a secret:</p><ol><li><strong>Create an Azure Key Vault</strong>:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az keyvault create --name MyKeyVault --resource-group MyResourceGroup --location eastus
</span></span></code></pre></div><p>Refer to the official documentation for <a href=https://learn.microsoft.com/en-us/azure/key-vault/general/quick-create-portal>creating and managing Azure Key Vault</a>.</p><ol start=2><li><strong>Add Secrets to the Vault</strong>:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az keyvault secret <span class=nb>set</span> --vault-name MyKeyVault --name MySecret --value <span class=s2>&#34;SuperSecretValue&#34;</span>
</span></span></code></pre></div><p>More details on <a href=https://learn.microsoft.com/en-us/azure/key-vault/secrets/quick-create-portal>storing and retrieving secrets</a> in Azure Key Vault.</p><h3 id=step-3-grant-access-to-the-vm-managed-identity->Step 3: Grant Access to the VM Managed Identity ğŸ¤–</h3><ol><li><strong>Assign the Managed Identity to the AKS Cluster</strong>:</li></ol><p>If your AKS cluster uses a <strong>system-assigned identity</strong>, this step may already be completed during cluster creation. However, if necessary, you can assign one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az aks update -g MyResourceGroup -n MyAKSCluster --assign-identity
</span></span></code></pre></div><p>This command enables the AKS cluster to use a VM Managed Identity, which Azure automatically manages. The identity is used to authenticate and access resources like Azure Key Vault.</p><ol start=2><li><strong>Grant Access to Azure Key Vault</strong>:</li></ol><p>Next, give the AKS cluster&rsquo;s VM Managed Identity permission to read secrets from the Key Vault:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az keyvault set-policy -n MyKeyVault --secret-permissions get --spn &lt;aks-identity-client-id&gt;
</span></span></code></pre></div><p>Replace <code>&lt;aks-identity-client-id></code> with the client ID of your AKS cluster&rsquo;s system-assigned identity. This allows the AKS cluster to retrieve secrets from the Azure Key Vault using its managed identity.</p><h3 id=step-4-configure-and-deploy-to-kubernetes->Step 4: Configure and Deploy to Kubernetes ğŸš€</h3><ol><li><strong>Create a SecretProviderClass for VM Managed Identity</strong>:</li></ol><p>Hereâ€™s how to configure the Secret Store CSI Driver to use the VM Managed Identity:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store.csi.x-k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>SecretProviderClass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>azure-keyvault-provider-vm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>azure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>useVMManagedIdentity</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>  </span><span class=c># Enables VM Managed Identity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>keyvaultName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;MyKeyVault&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>objects</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      array:
</span></span></span><span class=line><span class=cl><span class=sd>        - |
</span></span></span><span class=line><span class=cl><span class=sd>          objectName: MySecret
</span></span></span><span class=line><span class=cl><span class=sd>          objectType: secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tenantId</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;your-tenant-id&gt;&#34;</span><span class=w>
</span></span></span></code></pre></div><ul><li><p><strong><code>useVMManagedIdentity: "true"</code></strong>: This tells the Secret Store CSI Driver to authenticate to Azure Key Vault using the AKS clusterâ€™s VM Managed Identity.</p></li><li><p>Learn more about <a href=https://learn.microsoft.com/en-us/azure/aks/csi-secrets-store-driver>Secret Store CSI Driver</a> and how to configure it.</p></li></ul><ol start=2><li><strong>Deploy Your Application</strong>:</li></ol><p>Update your pod spec to mount the secrets:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod-vm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mycontainer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store-inline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/mnt/secrets-store&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store-inline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>csi</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store.csi.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeAttributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>secretProviderClass</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;azure-keyvault-provider-vm&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=step-5-access-your-secrets->Step 5: Access Your Secrets ğŸ‰</h3><p>Once deployed, your secret will be available in the mounted path within your container:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /mnt/secrets-store/MySecret
</span></span></code></pre></div><h2 id=method-2-securing-secrets-with-azure-key-vault-using-user-assigned-identity->Method 2: Securing Secrets with Azure Key Vault Using User Assigned Identity ğŸ”</h2><h3 id=understanding-user-assigned-identities->Understanding User Assigned Identities ğŸ¤”</h3><p><strong>User Assigned Managed Identities</strong> are identities created as standalone Azure resources. Unlike VM Managed Identities, these identities are not tied to any specific Azure resource and can be assigned to multiple resources, including VMs and AKS clusters. This gives you more control and flexibility, as you can create and manage identities independently of the lifecycle of any particular resource.</p><ul><li>Learn more about <a href=https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/how-manage-user-assigned-managed-identities>User Assigned Managed Identities</a>.</li></ul><h3 id=step-2-set-up-azure-key-vault--1>Step 2: Set Up Azure Key Vault â˜ï¸</h3><p>This step is similar to the first method:</p><ol><li><strong>Create an Azure Key Vault</strong>:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az keyvault create --name MyKeyVault --resource-group MyResourceGroup --location eastus
</span></span></code></pre></div><p>Refer to the official documentation for <a href=https://learn.microsoft.com/en-us/azure/key-vault/general/quick-create-portal>creating and managing Azure Key Vault</a>.</p><ol start=2><li><strong>Add Secrets to the Vault</strong>:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az keyvault secret <span class=nb>set</span> --vault-name MyKeyVault --name MySecret --value <span class=s2>&#34;SuperSecretValue&#34;</span>
</span></span></code></pre></div><p>More details on <a href=https://learn.microsoft.com/en-us/azure/key-vault/secrets/quick-create-portal>storing and retrieving secrets</a> in Azure Key Vault.</p><h3 id=step-3-set-up-a-user-assigned-managed-identity->Step 3: Set Up a User Assigned Managed Identity ğŸ”§</h3><ol><li><strong>Create a User Assigned Identity</strong>:</li></ol><p>Create a User Assigned Identity to attach to the AKS cluster:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az identity create --resource-group MyResourceGroup --name MyUserAssignedIdentity
</span></span></code></pre></div><p>Note the resource ID and client ID of this identity.</p><ul><li>Learn how to <a href=https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/how-manage-user-assigned-managed-identities>create a User Assigned Managed Identity</a>.</li></ul><ol start=2><li><strong>Grant Access to the User Assigned Identity</strong>:</li></ol><p>Next, grant the User Assigned Identity access to the Key Vault:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az keyvault set-policy -n MyKeyVault --secret-permissions get --spn &lt;user-assigned-client-id&gt;
</span></span></code></pre></div><p>Replace <code>&lt;user-assigned-client-id></code> with the client ID of the User Assigned Identity. This enables the identity to access secrets in the Azure Key Vault.</p><ol start=3><li><strong>Assign the Identity to AKS Cluster</strong>:</li></ol><p>Attach the User Assigned Identity to your AKS cluster:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az aks update -g MyResourceGroup -n MyAKSCluster --assign-identity &lt;user-assigned-identity-id&gt;
</span></span></code></pre></div><p>Replace <code>&lt;user-assigned-identity-id></code> with the resource ID of the User Assigned Identity. This allows the AKS cluster to authenticate using the User Assigned Identity.</p><ul><li>Learn more about <a href=https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/how-to-assign-access-azure-resource>assigning managed identities to Azure resources</a>.</li></ul><h3 id=step-4-configure-and-deploy-to-kubernetes--1>Step 4: Configure and Deploy to Kubernetes ğŸš€</h3><ol><li><strong>Create a SecretProviderClass for User Assigned Identity</strong>:</li></ol><p>Unlike in Method 1, we will disable the use of VM Managed Identities and configure the Secret Store CSI Driver to use the User Assigned Identity instead:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store.csi.x-k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>SecretProviderClass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>azure-keyvault-provider-user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>azure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>useVMManagedIdentity</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>  </span><span class=c># Disables VM Managed Identity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>userAssignedIdentityID</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;user-assigned-client-id&gt;&#34;</span><span class=w>  </span><span class=c># Specifies the User Assigned Identity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>keyvaultName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;MyKeyVault&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>objects</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      array:
</span></span></span><span class=line><span class=cl><span class=sd>        - |
</span></span></span><span class=line><span class=cl><span class=sd>          objectName: MySecret
</span></span></span><span class=line><span class=cl><span class=sd>          objectType: secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tenantId</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;your-tenant-id&gt;&#34;</span><span class=w>
</span></span></span></code></pre></div><ul><li><strong><code>useVMManagedIdentity: "false"</code></strong>: This disables the use of VM Managed Identity.</li><li><strong><code>userAssignedIdentityID: "&lt;user-assigned-client-id>"</code></strong>: Specifies the User Assigned Identity that will authenticate with Azure Key Vault.</li></ul><ol start=2><li><strong>Deploy Your Application</strong>:</li></ol><p>Update your pod spec as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod-user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mycontainer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store-inline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/mnt/secrets-store&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store-inline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>csi</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>secrets-store.csi.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeAttributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>secretProviderClass</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;azure-keyvault-provider-user&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=step-5-access-your-secrets--1>Step 5: Access Your Secrets ğŸ‰</h3><p>Access the mounted secret in your container as shown:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /mnt/secrets-store/MySecret
</span></span></code></pre></div><h2 id=wrapping-it-up->Wrapping It Up ğŸ</h2><p>By leveraging Azure Key Vault and the Secret Store CSI Driver in AKS, you can significantly improve the security of your Kubernetes Secrets. Whether you use <strong>VM Managed Identities</strong> or <strong>User Assigned Identities</strong>, you ensure that sensitive information is securely managed and accessed without directly storing credentials in your cluster.</p><ul><li><strong>VM Managed Identities</strong> are ideal for scenarios where you want the simplicity of automatic identity management tied to your AKS cluster&rsquo;s lifecycle.</li><li><strong>User Assigned Identities</strong> provide greater control and flexibility, allowing you to manage and share identities across multiple resources.</li></ul><p>By enabling the Secret Store CSI Driver in AKS, you make the integration process smoother and more secure, allowing your applications to seamlessly access secrets from Azure Key Vault. This approach not only simplifies secret management but also strengthens your security posture, reducing the risk of credential exposure.</p><p>Happy clustering, and keep those secrets safe! ğŸš€ğŸ”</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l/ aria-label="Previous - ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions" class="btn btn-primary"><span class=me-1>â†</span>Previous</a></li><li><a href=/blog/understanding-ebpf-and-its-application-in-modern-cloud-environments-3f99/ aria-label="Next - Understanding eBPF and Its Application in Modern Cloud Environments ğŸš€" class="btn btn-primary">Next<span class=ms-1>â†’</span></a></li></ul></div></main></div></div><footer class=km-footer role=contentinfo><style>.km-footer{background:#0a2540;color:#fff;padding:15px 0;margin:0;width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);border:0;outline:0;padding-left:0;padding-right:0}.km-footer a{color:#00d1b2;text-decoration:none}.km-footer .km-social{display:flex;justify-content:center;gap:20px;margin-top:8px}.km-footer .km-social a{color:#00d1b2!important;font-size:28px;line-height:1;transition:color .2s ease}.km-footer .km-social a:hover{color:#10b981!important}html,body{overflow-x:hidden}</style><div class=text-center><p class=mb-1 style=margin:0>Â© 2025 Kubermates powered by
<a href=https://kapheira.cloud>Kapheira</a> and
<a href=https://www.linkedin.com/in/hamdi-khelil/ rel=author>Hamdi KHELIL</a>.</p><div class=km-social><a href=https://github.com/kubermates-org target=_blank rel=noopener aria-label=GitHub><i class="fab fa-github" aria-hidden=true></i>
</a><a href=https://www.linkedin.com/company/kubermates target=_blank rel=noopener aria-label=LinkedIn><i class="fab fa-linkedin" aria-hidden=true></i>
</a><a href=https://www.youtube.com/@Kubermates target=_blank rel=noopener aria-label=YouTube><i class="fab fa-youtube" aria-hidden=true></i>
</a><a href=https://kubermates.slack.com target=_blank rel=noopener aria-label=Slack><i class="fab fa-slack" aria-hidden=true></i></a></div></div></footer></div><script src=/js/main.min.d844e8cb3c2d74f005336b0c873045728e53ff0ce5534c7d8563fa0676a87b08.js integrity="sha256-2EToyzwtdPAFM2sMhzBFco5T/wzlU0x9hWP6Bnaoewg=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>