<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions | Kubermates</title><meta name=description content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and..."><meta property="og:url" content="https://kubermates.org/blog/automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l/"><meta property="og:site_name" content="Kubermates"><meta property="og:title" content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions"><meta property="og:description" content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and..."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-09-03T14:52:24+00:00"><meta property="article:modified_time" content="2024-09-03T14:52:24+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Trivy"><meta property="article:tag" content="Githubactions"><meta itemprop=name content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions"><meta itemprop=description content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and..."><meta itemprop=datePublished content="2024-09-03T14:52:24+00:00"><meta itemprop=dateModified content="2024-09-03T14:52:24+00:00"><meta itemprop=wordCount content="2028"><meta itemprop=keywords content="Kubernetes,Azure,Trivy,Githubactions"><meta name=twitter:card content="summary"><meta name=twitter:title content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions"><meta name=twitter:description content="ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and..."><link rel=preload href=/scss/main.min.e8cc45d85315a21706a63b6ac89bd1b180ed25b3b643edc182d2d0d09e89769e.css as=style integrity="sha256-6MxF2FMVohcGpjtqyJvRsYDtJbO2Q+3BgtLQ0J6Jdp4=" crossorigin=anonymous><link href=/scss/main.min.e8cc45d85315a21706a63b6ac89bd1b180ed25b3b643edc182d2d0d09e89769e.css rel=stylesheet integrity="sha256-6MxF2FMVohcGpjtqyJvRsYDtJbO2Q+3BgtLQ0J6Jdp4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><link rel=icon href=/images/favicon.ico></head><body class="td-page td-blog"><header><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container-fluid><a class=navbar-brand href=https://kubermates.org/><img src=/images/logo.png alt="Kubermates Logo" height=40 class="d-inline-block align-text-top">
Kubermates
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class=nav-item><a class=nav-link href=/blog/>Articles</a></li><li class=nav-item><a class=nav-link href=/events/>Events</a></li><li class=nav-item><a class=nav-link href=/contribute/>Contribute</a></li></ul></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogfirst-post-li><a href=/blog/first-post/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogfirst-post><span>launching kubermates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih-li><a href=/blog/github-actions-composite-vs-reusable-workflows-4bih/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloggithub-actions-composite-vs-reusable-workflows-4bih><span>ğŸ§© GitHub Actions Composite vs Reusable Workflows</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc-li><a href=/blog/elevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogelevating-infrastructure-from-terraformterragrunt-foundations-to-platform-engineering-41fc><span>ğŸš€ğŸŒ Elevating Infrastructure: From Terraform/Terragrunt Foundations to Platform Engineering ğŸ˜Š</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-helm-1940-li><a href=/blog/secure-secret-management-with-sops-in-helm-1940/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-helm-1940><span>ğŸ” Secure Secret Management with SOPS in Helm ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a-li><a href=/blog/secure-secret-management-with-sops-in-terraform-terragrunt-231a/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecure-secret-management-with-sops-in-terraform-terragrunt-231a><span>ğŸ” Secure Secret Management with SOPS in Terraform & Terragrunt</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca-li><a href=/blog/helm-chart-essentials-writing-effective-charts-11ca/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghelm-chart-essentials-writing-effective-charts-11ca><span>Helm Chart Essentials & Writing Effective Charts ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89-li><a href=/blog/unlocking-secrets-with-external-secrets-operator-2f89/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunlocking-secrets-with-external-secrets-operator-2f89><span>Unlocking Secrets with External Secrets Operator ğŸ”âœ¨</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk-li><a href=/blog/automating-dns-in-azure-private-dns-with-external-dns-3knk/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautomating-dns-in-azure-private-dns-with-external-dns-3knk><span>Automating DNS in Azure Private DNS with External-DNS â˜ï¸ğŸ”</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh-li><a href=/blog/using-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogusing-nginx-ingress-controller-and-cert-manager-for-https-with-lets-encrypt-2flh><span>Using Nginx Ingress Controller and Cert-Manager for HTTPS with Letâ€™s Encrypt âš¡</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0-li><a href=/blog/ensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogensuring-effective-helm-charts-with-linting-testing-and-diff-checks-ni0><span>Ensuring Effective Helm Charts with Linting, Testing, and Diff Checks ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5-li><a href=/blog/capsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogcapsule-how-to-use-it-and-first-steps-to-set-it-up-on-an-aks-cluster-5hl5><span>Capsule: How to Use It and First Steps to Set It Up on an AKS Cluster ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh-li><a href=/blog/understanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-aks-nap-azure-kubernetes-service-node-auto-provisioning-powered-by-karpenter-3djh><span>Understanding AKS NAP: Azure Kubernetes Service Node Auto-Provisioning (Powered by Karpenter) ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d-li><a href=/blog/admission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogadmission-controllers-in-kubernetes-opa-gatekeeper-kyverno-and-azure-policy-add-on-for-aks-which-one-wins-237d><span>Admission Controllers in Kubernetes: OPA GateKeeper, Kyverno, and Azure Policy Add-on for AKSâ€”Which One Wins? ğŸ†</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap-li><a href=/blog/upgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogupgrading-aks-in-place-blue-green-and-canary-upgrades-explained-3aap><span>Upgrading AKS: In-Place, Blue-Green, and Canary Upgrades Explained ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627-li><a href=/blog/monitor-and-optimize-multi-cluster-aks-costs-4627/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogmonitor-and-optimize-multi-cluster-aks-costs-4627><span>Monitor and Optimize Multi-Cluster AKS Costs ğŸ’°</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida-li><a href=/blog/enhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogenhancing-container-security-the-complete-guide-to-secure-and-clean-kubernetes-clusters-1ida><span>ğŸš€ Enhancing Container Security: The Complete Guide to Secure and Clean Kubernetes Clusters ğŸ›¡ï¸ğŸ§¼</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08-li><a href=/blog/karmada-deep-dive-into-managing-multiple-aks-clusters-1j08/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkarmada-deep-dive-into-managing-multiple-aks-clusters-1j08><span>Karmada: Deep Dive into Managing Multiple AKS Clusters ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99-li><a href=/blog/understanding-ebpf-and-its-application-in-modern-cloud-environments-3f99/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-ebpf-and-its-application-in-modern-cloud-environments-3f99><span>Understanding eBPF and Its Application in Modern Cloud Environments ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k-li><a href=/blog/securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogsecuring-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k><span>ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l-li><a href=/blog/automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blogautomating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l><span class=td-sidebar-nav-active-item>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo-li><a href=/blog/autoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogautoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo><span>Autoscaling in Kubernetes: KEDA, Karpenter, and Native Autoscalers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g-li><a href=/blog/insights-on-securing-your-kubernetes-cluster-with-falco-4b9g/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloginsights-on-securing-your-kubernetes-cluster-with-falco-4b9g><span>Insights on Securing Your Kubernetes Cluster with Falco ğŸš€ğŸ”’</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil-li><a href=/blog/building-a-kubernetes-operator-with-an-nginx-crd-3lil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogbuilding-a-kubernetes-operator-with-an-nginx-crd-3lil><span>ğŸš€ Building a Kubernetes Operator with an NGINX CRD</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l-li><a href=/blog/hacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghacking-the-helm-operator-with-flux-creating-self-installable-services-for-easier-app-deployment-5a8l><span>ğŸ¨ Hacking the Helm Operator with Flux: Creating Self-Installable Services for Easier App Deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogchaos-engineering-lets-break-everything-io0-li><a href=/blog/chaos-engineering-lets-break-everything-io0/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogchaos-engineering-lets-break-everything-io0><span>Chaos Engineering Let's Break Everything! ğŸ˜ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017-li><a href=/blog/a-guide-to-modern-kubernetes-service-networking-4017/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-guide-to-modern-kubernetes-service-networking-4017><span>A Guide to Modern Kubernetes Service Networking ğŸš€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge-li><a href=/blog/effective-vulnerability-monitoring-in-kubernetes-1mge/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogeffective-vulnerability-monitoring-in-kubernetes-1mge><span>ğŸ›¡ï¸ Effective Vulnerability Monitoring in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-multi-cluster-management-1nek-li><a href=/blog/kubernetes-multi-cluster-management-1nek/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-multi-cluster-management-1nek><span>Kubernetes Multi-Cluster Management ğŸ“¦</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l-li><a href=/blog/how-to-make-your-docker-images-go-on-a-diet-88l/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-make-your-docker-images-go-on-a-diet-88l><span>How to Make Your Docker Images Go on a Diet ğŸŠâ€â™‚ï¸</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea-li><a href=/blog/a-quick-navigation-through-service-mesh-in-kubernetes-5dea/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloga-quick-navigation-through-service-mesh-in-kubernetes-5dea><span>A quick navigation through Service Mesh in Kubernetes ğŸ‘€</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o-li><a href=/blog/kubernetes-rbac-and-role-aggregation-made-easy-3j4o/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-rbac-and-role-aggregation-made-easy-3j4o><span>ğŸš€ Kubernetes RBAC and Role Aggregation Made Easy</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54-li><a href=/blog/essential-tips-for-setting-resource-limits-in-kubernetes-3b54/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogessential-tips-for-setting-resource-limits-in-kubernetes-3b54><span>Essential Tips for Setting Resource Limits in Kubernetes ğŸ“ˆ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3-li><a href=/blog/kubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogkubernetes-dns-how-to-use-in-cluster-and-azure-private-dns-together-48h3><span>ğŸŒ Kubernetes DNS: How to Use In-Cluster and Azure Private DNS Together</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33-li><a href=/blog/how-to-manage-kubernetes-app-storage-like-a-pro-o33/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-manage-kubernetes-app-storage-like-a-pro-o33><span>How to Manage Kubernetes App Storage Like a Pro ğŸ“</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2-li><a href=/blog/understanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blogunderstanding-pod-topology-spread-constraints-and-node-affinity-in-kubernetes-49a2><span>Understanding Pod Topology Spread Constraints and Node Affinity in Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec-li><a href=/blog/how-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-bloghow-to-test-the-latest-kubernetes-changes-in-version-131-elli-39ec><span>How to Test the Latest Kubernetes Changes in Version 1.31 "Elli"</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubermates-org/kubermates-site/tree/main/content/blog/2024-09-03-automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/kubermates-org/kubermates-site/edit/main/content/blog/2024-09-03-automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions-13l.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubermates-org/kubermates-site/new/main/content/blog?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/kubermates-org/kubermates-site/issues/new?title=%f0%9f%9a%80%20Automating%20Image%20Vulnerability%20Patching%20in%20Kubernetes%20with%20Trivy%20Operator,%20Copacetic,%20and%20GitHub%20Actions" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#1-installing-and-using-copacetic-copa-cli>1. Installing and Using Copacetic (Copa) CLI</a><ul><li><a href=#11-clone-the-copacetic-repository>1.1. Clone the Copacetic Repository</a></li><li><a href=#12-build-copacetic>1.2. Build Copacetic</a></li><li><a href=#13-install-copa-cli-optional>1.3. Install Copa CLI (Optional)</a></li></ul></li><li><a href=#2-scanning-and-patching-images-with-trivy-and-copa>2. Scanning and Patching Images with Trivy and Copa</a><ul><li><a href=#21-scan-the-container-image-for-patchable-os-vulnerabilities>2.1. Scan the Container Image for Patchable OS Vulnerabilities</a></li><li><a href=#22-patch-the-image-using-copa>2.2. Patch the Image Using Copa</a></li></ul></li><li><a href=#3-installing-trivy-operator-with-helm>3. Installing Trivy Operator with Helm</a><ul><li><a href=#31-add-the-aqua-security-helm-repository>3.1. Add the Aqua Security Helm Repository</a></li><li><a href=#32-update-your-helm-repositories>3.2. Update Your Helm Repositories</a></li><li><a href=#33-install-trivy-operator>3.3. Install Trivy Operator</a></li></ul></li><li><a href=#4-exporting-trivy-metrics>4. Exporting Trivy Metrics</a><ul><li><a href=#41-enable-metrics-export>4.1. Enable Metrics Export</a></li><li><a href=#42-access-trivy-metrics>4.2. Access Trivy Metrics</a></li></ul></li><li><a href=#5-setting-up-a-custom-webhook-to-trigger-a-github-action-for-copa>5. Setting Up a Custom Webhook to Trigger a GitHub Action for Copa</a><ul><li><a href=#51-deploy-a-custom-go-webhook>5.1. Deploy a Custom Go Webhook</a></li><li><a href=#52-set-up-a-github-action-to-patch-the-image-using-copa>5.2. Set Up a GitHub Action to Patch the Image Using Copa</a></li></ul></li><li><a href=#-wrapping-up>ğŸ‰ Wrapping Up</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/announcement/ data-taxonomy-term=announcement><span class=taxonomy-label>Announcement</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/automation/ data-taxonomy-term=automation><span class=taxonomy-label>Automation</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span><span class=taxonomy-count>13</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cicd/ data-taxonomy-term=cicd><span class=taxonomy-label>Cicd</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span><span class=taxonomy-count>28</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cloudnative/ data-taxonomy-term=cloudnative><span class=taxonomy-label>Cloudnative</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/cncf/ data-taxonomy-term=cncf><span class=taxonomy-label>Cncf</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/community/ data-taxonomy-term=community><span class=taxonomy-label>Community</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/containers/ data-taxonomy-term=containers><span class=taxonomy-label>Containers</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/devops/ data-taxonomy-term=devops><span class=taxonomy-label>Devops</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>Docker</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/falco/ data-taxonomy-term=falco><span class=taxonomy-label>Falco</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/finops/ data-taxonomy-term=finops><span class=taxonomy-label>Finops</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>Github</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/githubactions/ data-taxonomy-term=githubactions><span class=taxonomy-label>Githubactions</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/gitops/ data-taxonomy-term=gitops><span class=taxonomy-label>Gitops</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/karmada/ data-taxonomy-term=karmada><span class=taxonomy-label>Karmada</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span><span class=taxonomy-count>29</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/networking/ data-taxonomy-term=networking><span class=taxonomy-label>Networking</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/opensource/ data-taxonomy-term=opensource><span class=taxonomy-label>Opensource</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/platform-engineering/ data-taxonomy-term=platform-engineering><span class=taxonomy-label>Platform-Engineering</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/productivity/ data-taxonomy-term=productivity><span class=taxonomy-label>Productivity</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/programming/ data-taxonomy-term=programming><span class=taxonomy-label>Programming</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/servicemesh/ data-taxonomy-term=servicemesh><span class=taxonomy-label>Servicemesh</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terraform/ data-taxonomy-term=terraform><span class=taxonomy-label>Terraform</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/terragrunt/ data-taxonomy-term=terragrunt><span class=taxonomy-label>Terragrunt</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/trivy/ data-taxonomy-term=trivy><span class=taxonomy-label>Trivy</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/blog/>Blogs</a></li><li class="breadcrumb-item active" aria-current=page>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</li></ol></nav><div class=td-content><h1>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</h1><div class=lead>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and&mldr;</div><div class="td-byline mb-4"><time datetime=2024-09-03 class=text-body-secondary>Tuesday, September 03, 2024</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://kubermates.org/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/azure/ data-taxonomy-term=azure><span class=taxonomy-label>Azure</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/trivy/ data-taxonomy-term=trivy><span class=taxonomy-label>Trivy</span></a></li><li><a class=taxonomy-term href=https://kubermates.org/tags/githubactions/ data-taxonomy-term=githubactions><span class=taxonomy-label>Githubactions</span></a></li></ul></div></header><h1 id=-automating-image-vulnerability-patching-in-kubernetes-with-trivy-operator-copacetic-and-github-actions>ğŸš€ Automating Image Vulnerability Patching in Kubernetes with Trivy Operator, Copacetic, and GitHub Actions</h1><h2 id=1-installing-and-using-copacetic-copa-cli>1. Installing and Using Copacetic (Copa) CLI</h2><p>Copacetic is a CLI tool (<code>copa</code>) designed to help automate the patching of vulnerabilities in your container images. Hereâ€™s how to install it:</p><h3 id=11-clone-the-copacetic-repository>1.1. Clone the Copacetic Repository</h3><p>Start by cloning the Copacetic repository to your local machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/project-copacetic/copacetic
</span></span><span style=display:flex><span>cd copacetic
</span></span></code></pre></div><h3 id=12-build-copacetic>1.2. Build Copacetic</h3><p>Inside the cloned directory, build the Copacetic CLI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make
</span></span></code></pre></div><h3 id=13-install-copa-cli-optional>1.3. Install Copa CLI (Optional)</h3><p>If you want to install the <code>copa</code> command to a directory in your system&rsquo;s <code>PATH</code>, move the binary to a pathed folder:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mv dist/linux_amd64/release/copa /usr/local/bin/
</span></span></code></pre></div><p>This allows you to run <code>copa</code> from anywhere in your terminal.</p><h2 id=2-scanning-and-patching-images-with-trivy-and-copa>2. Scanning and Patching Images with Trivy and Copa</h2><p>Once you have installed both Trivy and Copacetic, you can start scanning your images and patching vulnerabilities.</p><h3 id=21-scan-the-container-image-for-patchable-os-vulnerabilities>2.1. Scan the Container Image for Patchable OS Vulnerabilities</h3><p>Use Trivy to scan the container image for operating system vulnerabilities. The results will be output to a JSON file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>trivy image --vuln-type os --ignore-unfixed -f json -o <span style=color:#66d9ef>$(</span>basename $IMAGE<span style=color:#66d9ef>)</span>.json $IMAGE
</span></span></code></pre></div><ul><li>Replace <code>$IMAGE</code> with the name of the container image you want to scan (e.g., <code>nginx:latest</code>).</li><li>The command will create a JSON file with the same name as the image, which contains details about the vulnerabilities found.</li></ul><h3 id=22-patch-the-image-using-copa>2.2. Patch the Image Using Copa</h3><p>After generating the Trivy report, use Copa to patch the image based on the vulnerabilities reported:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>copa patch -r <span style=color:#66d9ef>$(</span>basename $IMAGE<span style=color:#66d9ef>)</span>.json -i $IMAGE
</span></span></code></pre></div><ul><li>This command reads the vulnerability report from the JSON file and patches the specified image.</li><li>By default, Copa will produce a new image with a <code>-patched</code> suffix (e.g., <code>nginx-patched</code>), tagging it with the original image tag suffixed with <code>-patched</code>.</li><li>The new patched image will be exported to your local Docker daemon.</li></ul><h2 id=3-installing-trivy-operator-with-helm>3. Installing Trivy Operator with Helm</h2><p>Once youâ€™ve patched your container images, you can use Trivy Operator to continuously monitor your AKS cluster for any vulnerabilities.</p><h3 id=31-add-the-aqua-security-helm-repository>3.1. Add the Aqua Security Helm Repository</h3><p>First, add the Aqua Security Helm repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add aqua https://aquasecurity.github.io/helm-charts/
</span></span></code></pre></div><p>For more details, visit the <a href=https://aquasecurity.github.io/helm-charts/>Aqua Security Helm Charts documentation</a>.</p><h3 id=32-update-your-helm-repositories>3.2. Update Your Helm Repositories</h3><p>Update your Helm repositories to get the latest charts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo update
</span></span></code></pre></div><h3 id=33-install-trivy-operator>3.3. Install Trivy Operator</h3><p>Finally, install the Trivy Operator:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install trivy-operator aqua/trivy-operator --namespace trivy-system --create-namespace
</span></span></code></pre></div><p>Trivy Operator will now be running in your AKS cluster, ready to scan for vulnerabilities. You can find more detailed instructions in the <a href=https://aquasecurity.github.io/trivy-operator/latest/getting-started/installation/helm/>Trivy Operator documentation</a>.</p><h2 id=4-exporting-trivy-metrics>4. Exporting Trivy Metrics</h2><p>Once Trivy Operator is up and running, itâ€™s important to monitor the health of your cluster by exporting Trivy metrics. These metrics provide valuable insights into the security posture of your container images.</p><h3 id=41-enable-metrics-export>4.1. Enable Metrics Export</h3><p>Trivy Operator can export metrics to Prometheus, allowing you to monitor the security status of your AKS cluster over time.</p><ol><li><p><strong>Edit the Trivy Operator ConfigMap</strong>:</p><p>Enable the metrics exporter in the Trivy Operator&rsquo;s ConfigMap:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl edit configmap trivy-operator-config -n trivy-system
</span></span></code></pre></div></li><li><p><strong>Add or Modify the Following Configuration</strong>:</p><p>Ensure the following settings are enabled in the ConfigMap:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>trivy.severity</span>: <span style=color:#e6db74>&#34;HIGH,CRITICAL&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>trivy.resources.requests.cpu</span>: <span style=color:#e6db74>&#34;100m&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>trivy.resources.requests.memory</span>: <span style=color:#e6db74>&#34;100Mi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>trivy.resources.limits.cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>trivy.resources.limits.memory</span>: <span style=color:#e6db74>&#34;500Mi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>trivy.metrics.enabled</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><p>This configuration ensures that Trivy Operator will export security metrics to Prometheus.</p></li></ol><h3 id=42-access-trivy-metrics>4.2. Access Trivy Metrics</h3><p>With metrics enabled, you can scrape them using Prometheus and visualize them in Grafana or another monitoring tool of your choice. This allows you to track the number of vulnerabilities over time, monitor the effectiveness of your security patches, and respond to new threats promptly.</p><h2 id=5-setting-up-a-custom-webhook-to-trigger-a-github-action-for-copa>5. Setting Up a Custom Webhook to Trigger a GitHub Action for Copa</h2><p>To fully automate the process of patching images, you can set up a custom webhook that triggers a GitHub Action when a vulnerability is detected by Trivy Operator.</p><h3 id=51-deploy-a-custom-go-webhook>5.1. Deploy a Custom Go Webhook</h3><p>You can deploy a Go application that watches for new or updated vulnerability reports and triggers a GitHub Actions workflow. Below is a step-by-step guide on how to build, configure, and deploy this custom webhook within your cluster.</p><h4 id=511-set-up-your-go-application>5.1.1. Set Up Your Go Application</h4><p>Create a new Go module (for example, <code>trivy-webhook</code>) and initialize it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir trivy-webhook
</span></span><span style=display:flex><span>cd trivy-webhook
</span></span><span style=display:flex><span>go mod init github.com/your-username/trivy-webhook
</span></span></code></pre></div><p>Create a <code>main.go</code> file with the following sample code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;bytes&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>metav1</span> <span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/apis/meta/v1/unstructured&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/runtime/schema&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/watch&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;k8s.io/client-go/dynamic&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;k8s.io/client-go/plugin/pkg/client/auth&#34;</span> <span style=color:#75715e>// Enable auth plugins if needed (GKE, etc.)</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;k8s.io/client-go/rest&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// DispatchRequest represents the payload sent to GitHub Actions</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DispatchRequest</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>EventType</span>     <span style=color:#66d9ef>string</span>            <span style=color:#e6db74>`json:&#34;event_type&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ClientPayload</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;client_payload&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Pull environment variables</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>githubToken</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>TrimSpace</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;GITHUB_TOKEN&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>githubRepoOwner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>TrimSpace</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;GITHUB_REPO_OWNER&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>githubRepoName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>TrimSpace</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;GITHUB_REPO_NAME&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>githubToken</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>githubRepoOwner</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>githubRepoName</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;Missing required environment variables: GITHUB_TOKEN, GITHUB_REPO_OWNER, GITHUB_REPO_NAME&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create in-cluster K8s config</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>config</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rest</span>.<span style=color:#a6e22e>InClusterConfig</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;Failed to create in-cluster config: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create a dynamic client</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dynClient</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dynamic</span>.<span style=color:#a6e22e>NewForConfig</span>(<span style=color:#a6e22e>config</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;Failed to create dynamic client: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Define the GroupVersionResource for Trivy VulnerabilityReports</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>gvr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>GroupVersionResource</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Group</span>:    <span style=color:#e6db74>&#34;aquasecurity.github.io&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Version</span>:  <span style=color:#e6db74>&#34;v1alpha1&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Resource</span>: <span style=color:#e6db74>&#34;vulnerabilityreports&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Watch vulnerabilityreports across all namespaces</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>watchInterface</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dynClient</span>.<span style=color:#a6e22e>Resource</span>(<span style=color:#a6e22e>gvr</span>).<span style=color:#a6e22e>Namespace</span>(<span style=color:#e6db74>&#34;&#34;</span>).<span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>{})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;Failed to watch vulnerability reports: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Listening for new or updated Trivy VulnerabilityReports...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Process events</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>watchInterface</span>.<span style=color:#a6e22e>ResultChan</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Type</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Added</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Type</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>watch</span>.<span style=color:#a6e22e>Modified</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// We expect *unstructured.Unstructured</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>u</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Object</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>Unstructured</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Could not convert event object to Unstructured&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Parse the top-level object</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>namespace</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>GetNamespace</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// The &#39;report&#39; field is nested under .spec or top-level &#39;report&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>report</span>, <span style=color:#a6e22e>found</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>NestedMap</span>(<span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#e6db74>&#34;report&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> !<span style=color:#a6e22e>found</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;No &#39;report&#39; field found in %s/%s\n&#34;</span>, <span style=color:#a6e22e>namespace</span>, <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Extract artifact -&gt; repository + tag</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>artifact</span>, <span style=color:#a6e22e>found</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>NestedMap</span>(<span style=color:#a6e22e>report</span>, <span style=color:#e6db74>&#34;artifact&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> !<span style=color:#a6e22e>found</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;No &#39;artifact&#39; info found in %s/%s\n&#34;</span>, <span style=color:#a6e22e>namespace</span>, <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>repository</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>NestedString</span>(<span style=color:#a6e22e>artifact</span>, <span style=color:#e6db74>&#34;repository&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>tag</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>NestedString</span>(<span style=color:#a6e22e>artifact</span>, <span style=color:#e6db74>&#34;tag&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>image</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>repository</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tag</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>image</span> = <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s:%s&#34;</span>, <span style=color:#a6e22e>repository</span>, <span style=color:#a6e22e>tag</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Extract vulnerabilities array</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>vulns</span>, <span style=color:#a6e22e>found</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>NestedSlice</span>(<span style=color:#a6e22e>report</span>, <span style=color:#e6db74>&#34;vulnerabilities&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> !<span style=color:#a6e22e>found</span> <span style=color:#f92672>||</span> len(<span style=color:#a6e22e>vulns</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;No vulnerabilities found in %s/%s\n&#34;</span>, <span style=color:#a6e22e>namespace</span>, <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// For example, just take the first vulnerability</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>firstVuln</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>vulns</span>[<span style=color:#ae81ff>0</span>].(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{})
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>vulnID</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>firstVuln</span>[<span style=color:#e6db74>&#34;vulnID&#34;</span>].(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Detected vulnerability %q in image %s (namespace: %s)&#34;</span>, <span style=color:#a6e22e>vulnID</span>, <span style=color:#a6e22e>image</span>, <span style=color:#a6e22e>namespace</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Trigger GitHub Action with the extracted data</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>triggerGithubAction</span>(<span style=color:#a6e22e>githubToken</span>, <span style=color:#a6e22e>githubRepoOwner</span>, <span style=color:#a6e22e>githubRepoName</span>, <span style=color:#a6e22e>vulnID</span>, <span style=color:#a6e22e>image</span>, <span style=color:#a6e22e>namespace</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Failed to trigger GitHub Actions for %s/%s: %v&#34;</span>, <span style=color:#a6e22e>namespace</span>, <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>GetName</span>(), <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Triggered GitHub Actions for %s/%s successfully&#34;</span>, <span style=color:#a6e22e>namespace</span>, <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// triggerGithubAction sends a repository_dispatch event to the specified GitHub repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>triggerGithubAction</span>(<span style=color:#a6e22e>token</span>, <span style=color:#a6e22e>owner</span>, <span style=color:#a6e22e>repo</span>, <span style=color:#a6e22e>vulnID</span>, <span style=color:#a6e22e>image</span>, <span style=color:#a6e22e>namespace</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>url</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;https://api.github.com/repos/%s/%s/dispatches&#34;</span>, <span style=color:#a6e22e>owner</span>, <span style=color:#a6e22e>repo</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Build the JSON payload</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dispatchBody</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>DispatchRequest</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>EventType</span>: <span style=color:#e6db74>&#34;trivy_vulnerability_detected&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ClientPayload</span>: <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;vuln_id&#34;</span>:   <span style=color:#a6e22e>vulnID</span>,
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;image&#34;</span>:     <span style=color:#a6e22e>image</span>,
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;namespace&#34;</span>: <span style=color:#a6e22e>namespace</span>,
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>body</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>body</span>).<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>dispatchBody</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to encode JSON payload: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewRequest</span>(<span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#a6e22e>url</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to create request: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// NOTE: &#34;Bearer &lt;token&gt;&#34; or &#34;token &lt;token&gt;&#34; can work.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// With classic PAT, &#34;token &lt;PAT&gt;&#34; is standard, but &#34;Bearer&#34; often works as well.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Authorization&#34;</span>, <span style=color:#e6db74>&#34;Bearer &#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>token</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>client</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Client</span>{<span style=color:#a6e22e>Timeout</span>: <span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to send request: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>StatusCode</span> &lt; <span style=color:#ae81ff>200</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>StatusCode</span> &gt; <span style=color:#ae81ff>299</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unexpected status code from GitHub: %d&#34;</span>, <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>StatusCode</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=notes-on-the-code>Notes on the Code</h5><ul><li><p><strong>Watching Vulnerability Reports</strong>: The above code uses a <code>Watch()</code> call on the <code>vulnerabilityreports.aquasecurity.github.io/v1alpha1</code> resource. Whenever a resource is <strong>added</strong> or <strong>modified</strong>, the code sends a GitHub repository dispatch event.</p></li><li><p><strong>DispatchRequest</strong>: The structure conforms to GitHub&rsquo;s <a href=https://docs.github.com/en/rest/repos/repos#create-a-repository-dispatch-event>repository_dispatch</a> JSON payload requirements.</p></li><li><p><strong>Environment Variables</strong>:</p><ul><li><code>GITHUB_TOKEN</code> must be a Personal Access Token (classic) or a GitHub App token with permission to create repository dispatch events.</li><li><code>GITHUB_REPO_OWNER</code> is your GitHub username or organization name.</li><li><code>GITHUB_REPO_NAME</code> is the target repository to which you want to dispatch events.</li></ul></li></ul><h4 id=512-build--push-the-docker-image>5.1.2. Build & Push the Docker Image</h4><p>Create a Dockerfile (named <code>Dockerfile</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># Use a minimal base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> golang:1.20-alpine as builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> go.mod go.sum ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> go mod download<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> go build -o trivy-webhook main.go<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Final stage</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> alpine:3.18</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apk add --no-cache ca-certificates<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/trivy-webhook /usr/local/bin/<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;/usr/local/bin/trivy-webhook&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Build and push the Docker image:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t your-dockerhub-username/trivy-webhook:latest .
</span></span><span style=display:flex><span>docker push your-dockerhub-username/trivy-webhook:latest
</span></span></code></pre></div><h4 id=513-deploy-the-webhook-in-your-kubernetes-cluster>5.1.3. Deploy the Webhook in Your Kubernetes Cluster</h4><p>Create a Deployment and Service in the same namespace as Trivy Operator (often <code>trivy-system</code>) or any namespace you prefer. For example, create <code>deployment.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>trivy-custom-webhook</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trivy-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>trivy-custom-webhook</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>trivy-custom-webhook</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>trivy-webhook</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>your-dockerhub-username/trivy-webhook:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GITHUB_TOKEN</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>github-token-secret</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GITHUB_REPO_OWNER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;your-username&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GITHUB_REPO_NAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;your-repo&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add any other environment vars needed</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Optionally set serviceAccount if you have RBAC for accessing VulnerabilityReports</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>trivy-operator</span>
</span></span></code></pre></div><p>Deploy it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f deployment.yaml
</span></span></code></pre></div><p>Make sure that the <code>github-token-secret</code> exists in the <code>trivy-system</code> namespace and contains your GitHub token. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Secret</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>github-token-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trivy-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>Opaque</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>token</span>: <span style=color:#ae81ff>&lt;BASE64_ENCODED_GITHUB_TOKEN&gt;</span>
</span></span></code></pre></div><h4 id=514-configure-rbac-for-the-webhook-if-needed>5.1.4. Configure RBAC for the Webhook (If Needed)</h4><p>If your cluster enforces RBAC, ensure your <code>trivy-custom-webhook</code> Deployment (the ServiceAccount it uses) has permission to <code>list</code> and <code>watch</code> <code>vulnerabilityreports.aquasecurity.github.io</code>. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Role</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>trivy-webhook-role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trivy-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiGroups</span>: [<span style=color:#e6db74>&#34;aquasecurity.github.io&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>: [<span style=color:#e6db74>&#34;vulnerabilityreports&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>verbs</span>: [<span style=color:#e6db74>&#34;get&#34;</span>, <span style=color:#e6db74>&#34;list&#34;</span>, <span style=color:#e6db74>&#34;watch&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>RoleBinding</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>trivy-webhook-binding</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trivy-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>subjects</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>trivy-operator</span> <span style=color:#75715e># or the name you set in your Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>trivy-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>roleRef</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>trivy-webhook-role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>apiGroup</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io</span>
</span></span></code></pre></div><h4 id=515-verify-and-test>5.1.5. Verify and Test</h4><ol><li><p><strong>Check Logs</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs deployment/trivy-custom-webhook -n trivy-system
</span></span></code></pre></div><p>You should see a message indicating itâ€™s watching vulnerability reports.</p></li><li><p><strong>Generate a Vulnerability Report</strong><br>Install or update a Deployment in your cluster to trigger Trivy Operator to scan for vulnerabilities. When a new vulnerability report is generated, your logs should show that it detected a new report and sent a dispatch event to GitHub.</p></li></ol><h3 id=52-set-up-a-github-action-to-patch-the-image-using-copa>5.2. Set Up a GitHub Action to Patch the Image Using Copa</h3><p>Now, create a GitHub Action in your repository that uses the <code>copa-action</code> to patch the image.</p><ol><li><p><strong>Create a GitHub Action Workflow</strong>:</p><p>In your GitHub repository, create a new file at <code>.github/workflows/patch-image.yml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span> <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Patch Docker Image</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>repository_dispatch</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>types</span>: [<span style=color:#ae81ff>trivy_vulnerability_detected]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>patch</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>       - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Checkout repository</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#75715e># Copacetic will run its own Trivy scan automatically if you do NOT provide a &#39;report&#39;.</span>
</span></span><span style=display:flex><span>       - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Patch the Docker Image with Copacetic</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>id</span>: <span style=color:#ae81ff>copa</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>project-copacetic/copa-action@main</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>with</span>: 
</span></span><span style=display:flex><span>           <span style=color:#f92672>image</span>: <span style=color:#ae81ff>${{ github.event.client_payload.image }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#75715e># see https://github.com/docker/login-action#usage for other registries</span>
</span></span><span style=display:flex><span>       - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Login to GHCR</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>if</span>: <span style=color:#ae81ff>steps.copa.conclusion == &#39;success&#39;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>id</span>: <span style=color:#ae81ff>login</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/login-action@343f7c4344506bcbf9b4de18042ae17996df046d</span> <span style=color:#75715e># v3.0.0</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>           <span style=color:#f92672>registry</span>: <span style=color:#ae81ff>ghcr.io</span>
</span></span><span style=display:flex><span>           <span style=color:#f92672>username</span>: <span style=color:#ae81ff>${{ github.actor }}</span>
</span></span><span style=display:flex><span>           <span style=color:#f92672>password</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Push patched image</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>if</span>: <span style=color:#ae81ff>steps.login.conclusion == &#39;success&#39;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>           docker tag ${{ github.event.client_payload.image }}:patched your-docker-repo/${{ github.event.client_payload.image }}:patched
</span></span></span><span style=display:flex><span><span style=color:#e6db74>           docker push your-docker-repo/${{ github.event.client_payload.image }}:patched</span>
</span></span></code></pre></div><ul><li>Replace <code>your-docker-repo</code> with your Docker registry&rsquo;s name.</li><li>This workflow will automatically run when the webhook from Trivy Operator triggers it, patching the vulnerable image using <code>copa-action</code> and pushing the patched image to your Docker registry.</li></ul></li></ol><h2 id=-wrapping-up>ğŸ‰ Wrapping Up</h2><p>By integrating Trivy Operator with Copacetic and GitHub Actions, you&rsquo;ve created a fully automated workflow for detecting, patching, and monitoring vulnerabilities in your Kubernetes environment. Trivy Operator scans and exports metrics, while the custom webhook and GitHub Action using <code>copa-action</code> handle the patching process. This setup ensures that your container images are always up-to-date and secure, with minimal manual intervention.</p><p>This approach provides an efficient, automated solution for managing security in your Kubernetes environment, allowing you to focus on innovation with peace of mind! ğŸš€ğŸ”’</p><p>For further reading and more detailed guides, you can refer to the following resources:</p><ul><li><a href=https://aquasecurity.github.io/trivy/latest/>Trivy Documentation</a></li><li><a href=https://github.com/project-copacetic/copacetic>Copacetic GitHub Repository</a></li><li><a href=https://docs.github.com/en/actions>GitHub Actions Documentation</a></li><li><a href=https://github.com/project-copacetic/copa-action>Copa GitHub Action</a></li></ul><p>Happy clustering and stay safe !</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/autoscaling-in-kubernetes-keda-karpenter-and-native-autoscalers-1gpo/ aria-label="Previous - Autoscaling in Kubernetes: KEDA, Karpenter, and Native Autoscalers" class="btn btn-primary"><span class=me-1>â†</span>Previous</a></li><li><a href=/blog/securing-kubernetes-secrets-in-aks-using-azure-key-vault-with-managed-and-user-assigned-identities-569k/ aria-label="Next - ğŸŒ Securing Kubernetes Secrets in AKS: Using Azure Key Vault with Managed and User Assigned Identities ğŸš€" class="btn btn-primary">Next<span class=ms-1>â†’</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Kubermates powered by Kapheira</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.d844e8cb3c2d74f005336b0c873045728e53ff0ce5534c7d8563fa0676a87b08.js integrity="sha256-2EToyzwtdPAFM2sMhzBFco5T/wzlU0x9hWP6Bnaoewg=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>