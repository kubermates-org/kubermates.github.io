{{ define "main" }}
<style>
  .release-card { transition: transform .12s ease, box-shadow .12s ease; border: 1px solid rgba(255,255,255,.08); }
  .release-card:hover { transform: translateY(-3px); box-shadow: 0 .75rem 1.5rem rgba(0,0,0,.12); }
  .release-title a { text-decoration: none; }
  .release-title a:hover { text-decoration: underline; }
  .badge-soft { background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.15); }
</style>

<section class="section">
  <div class="container">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {{ range .Paginator.Pages }}
        {{ $page := . }}
        {{ $internal := .RelPermalink }}
        {{ $external := .Params.external_url }}

        <div class="col">
          <div class="card h-100 shadow-sm release-card position-relative">
            <div class="card-body d-flex flex-column">
              <!-- Title -> ALWAYS internal page -->
              <h2 class="h5 release-title mb-1">
                <a class="stretched-link" href="{{ $internal }}">{{ .Title }}</a>
              </h2>

              {{ with .Date }}
                <div class="text-muted small mb-2">{{ .Format "2006-01-02" }}</div>
              {{ end }}

              {{/* Optional micro-blurb: prefer .Params.tldr/.Params.description in list, but keep it short */}}
              {{ $blurb := or .Params.tldr .Params.description }}
              {{ with $blurb }}
                <p class="mb-3 text-muted small">{{ . | plainify | truncate 110 }}</p>
              {{ end }}

              <div class="mt-auto d-flex flex-wrap gap-2">
                {{ $tags := .Params.tags | default (slice) }}
                {{ range first 2 $tags }}
                  <a class="badge rounded-pill badge-soft text-light small" href="/tags/{{ . | urlize }}/">#{{ . }}</a>
                {{ end }}
                {{ if gt (len $tags) 2 }}
                  <span class="badge rounded-pill bg-secondary-subtle text-body-secondary small">+{{ sub (len $tags) 2 }}</span>
                {{ end }}
                {{ with .Params.source }}
                  <span class="badge rounded-pill bg-primary-subtle text-primary-emphasis small ms-auto">{{ . }}</span>
                {{ end }}
              </div>
            </div>

            <div class="card-footer bg-transparent border-0 pt-0 pb-3 px-3">
              <div class="d-grid gap-2">
                <!-- Primary action -> internal page (see TL;DR + Summary there) -->
                <a class="btn btn-light btn-sm" href="{{ $internal }}">Open details</a>
                <!-- Secondary action -> external_url if present -->
                {{ with $external }}
                  <a class="btn btn-outline-light btn-sm" href="{{ . }}" target="_blank" rel="noopener">Original â†—</a>
                {{ end }}
              </div>
            </div>
          </div>
        </div>
      {{ end }}
    </div>

    <nav class="mt-4">
      {{ template "_internal/pagination.html" . }}
    </nav>
  </div>
</section>
{{ end }}
